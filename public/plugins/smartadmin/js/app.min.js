function App(){}function nav_page_height(){var e=$("#main").height(),t=$(window).height()-$.navbar_height;e>t?($.left_panel.css("min-height",e+"px"),$.root_.css("min-height",e+$.navbar_height+"px")):($.left_panel.css("min-height",t+"px"),$.root_.css("min-height",t+"px"))}function check_if_mobile_width(){$(window).width()<979?$.root_.addClass("mobile-view-activated"):$.root_.hasClass("mobile-view-activated")&&$.root_.removeClass("mobile-view-activated")}function launchFullscreen(e){$.root_.hasClass("full-screen")?($.root_.removeClass("full-screen"),document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()):($.root_.addClass("full-screen"),e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen())}function runAllForms(){$.fn.slider&&$(".slider").slider(),$.fn.select2&&$(".select2").each(function(){var e=$(this),t=e.attr("data-select-width")||"100%";e.select2({allowClear:!0,width:t})}),$.fn.mask&&$("[data-mask]").each(function(){var e=$(this),t=e.attr("data-mask")||"error...",a=e.attr("data-mask-placeholder")||"X";e.mask(t,{placeholder:a})}),$.fn.autocomplete&&$("[data-autocomplete]").each(function(){var e=$(this),t=e.data("autocomplete")||["The","Quick","Brown","Fox","Jumps","Over","Three","Lazy","Dogs"];e.autocomplete({source:t})}),$.fn.datepicker&&($(".datepicker").each(function(){var e=$(this),t=e.attr("data-dateformat")||"yy-mm-dd";e.datepicker({dateFormat:t,prevText:'<i class="fa fa-chevron-left"></i>',nextText:'<i class="fa fa-chevron-right"></i>'})}),$(".hasDatepicker").on("blur",function(e){$(this).datepicker("hide")})),$("button[data-loading-text]").on("click",function(){var e=$(this);e.button("loading"),setTimeout(function(){e.button("reset")},3e3)})}function runAllCharts(){$.fn.sparkline&&$(".sparkline").each(function(){var e=$(this),t=e.data("sparkline-type")||"bar";if("bar"==t){var a=e.data("sparkline-bar-color")||e.css("color")||"#0000f0",d=e.data("sparkline-height")||"26px",o=e.data("sparkline-barwidth")||5,i=e.data("sparkline-barspacing")||2,n=e.data("sparkline-negbar-color")||"#A90329",l=e.data("sparkline-barstacked-color")||["#A90329","#0099c6","#98AA56","#da532c","#4490B1","#6E9461","#990099","#B4CAD3"];e.sparkline("html",{type:"bar",barColor:a,type:t,height:d,barWidth:o,barSpacing:i,stackedBarColor:l,negBarColor:n,zeroAxis:"false"})}if("line"==t){var d=e.data("sparkline-height")||"20px",s=e.data("sparkline-width")||"90px",r=e.data("sparkline-line-color")||e.css("color")||"#0000f0",c=e.data("sparkline-line-width")||1,u=e.data("fill-color")||"#c0d0f0",m=e.data("sparkline-spot-color")||"#f08000",h=e.data("sparkline-minspot-color")||"#ed1c24",p=e.data("sparkline-maxspot-color")||"#f08000",f=e.data("sparkline-highlightspot-color")||"#50f050",v=e.data("sparkline-highlightline-color")||"f02020",g=e.data("sparkline-spotradius")||1.5;thisChartMinYRange=e.data("sparkline-min-y")||"undefined",thisChartMaxYRange=e.data("sparkline-max-y")||"undefined",thisChartMinXRange=e.data("sparkline-min-x")||"undefined",thisChartMaxXRange=e.data("sparkline-max-x")||"undefined",thisMinNormValue=e.data("min-val")||"undefined",thisMaxNormValue=e.data("max-val")||"undefined",thisNormColor=e.data("norm-color")||"#c0c0c0",thisDrawNormalOnTop=e.data("draw-normal")||!1,e.sparkline("html",{type:"line",width:s,height:d,lineWidth:c,lineColor:r,fillColor:u,spotColor:m,minSpotColor:h,maxSpotColor:p,highlightSpotColor:f,highlightLineColor:v,spotRadius:g,chartRangeMin:thisChartMinYRange,chartRangeMax:thisChartMaxYRange,chartRangeMinX:thisChartMinXRange,chartRangeMaxX:thisChartMaxXRange,normalRangeMin:thisMinNormValue,normalRangeMax:thisMaxNormValue,normalRangeColor:thisNormColor,drawNormalOnTop:thisDrawNormalOnTop})}if("pie"==t){var b=e.data("sparkline-piecolor")||["#B4CAD3","#4490B1","#98AA56","#da532c","#6E9461","#0099c6","#990099","#717D8A"],w=e.data("sparkline-piesize")||90,_=e.data("border-color")||"#45494C",y=e.data("sparkline-offset")||0;e.sparkline("html",{type:"pie",width:w,height:w,tooltipFormat:'<span style="color: {{color}}">&#9679;</span> ({{percent.1}}%)',sliceColors:b,offset:0,borderWidth:1,offset:y,borderColor:_})}if("box"==t){var k=e.data("sparkline-width")||"auto",C=e.data("sparkline-height")||"auto",x=e.data("sparkline-boxraw")||!1,T=e.data("sparkline-targetval")||"undefined",z=e.data("sparkline-min")||"undefined",S=e.data("sparkline-max")||"undefined",q=e.data("sparkline-showoutlier")||!0,j=e.data("sparkline-outlier-iqr")||1.5,A=e.data("sparkline-spotradius")||1.5,P=e.css("color")||"#000000",E=e.data("fill-color")||"#c0d0f0",R=e.data("sparkline-whis-color")||"#000000",O=e.data("sparkline-outline-color")||"#303030",U=e.data("sparkline-outlinefill-color")||"#f0f0f0",D=e.data("sparkline-outlinemedian-color")||"#f00000",L=e.data("sparkline-outlinetarget-color")||"#40a020";e.sparkline("html",{type:"box",width:k,height:C,raw:x,target:T,minValue:z,maxValue:S,showOutliers:q,outlierIQR:j,spotRadius:A,boxLineColor:P,boxFillColor:E,whiskerColor:R,outlierLineColor:O,outlierFillColor:U,medianColor:D,targetColor:L})}if("bullet"==t){var M=e.data("sparkline-height")||"auto",F=e.data("sparkline-width")||2,N=e.data("sparkline-bullet-color")||"#ed1c24",I=e.data("sparkline-performance-color")||"#3030f0",K=e.data("sparkline-bulletrange-color")||["#d3dafe","#a8b6ff","#7f94ff"];e.sparkline("html",{type:"bullet",height:M,targetWidth:F,targetColor:N,performanceColor:I,rangeColors:K})}if("discrete"==t){var B=e.data("sparkline-height")||26,W=e.data("sparkline-width")||50,Y=e.css("color"),H=e.data("sparkline-line-height")||5,V=e.data("sparkline-threshold")||"undefined",G=e.data("sparkline-threshold-color")||"#ed1c24";e.sparkline("html",{type:"discrete",width:W,height:B,lineColor:Y,lineHeight:H,thresholdValue:V,thresholdColor:G})}if("tristate"==t){var X=e.data("sparkline-height")||26,J=(e.data("sparkline-posbar-color")||"#60f060",e.data("sparkline-negbar-color")||"#f04040"),Q=e.data("sparkline-zerobar-color")||"#909090",Z=e.data("sparkline-barwidth")||5,ee=e.data("sparkline-barspacing")||2,te=e.data("sparkline-zeroaxis")||!1;e.sparkline("html",{type:"tristate",height:X,posBarColor:ae,negBarColor:J,zeroBarColor:Q,barWidth:Z,barSpacing:ee,zeroAxis:te})}if("compositebar"==t){var d=e.data("sparkline-height")||"20px",s=e.data("sparkline-width")||"100%",o=e.data("sparkline-barwidth")||3,c=e.data("sparkline-line-width")||1,r=e.data("sparkline-color-top")||"#ed1c24",ae=e.data("sparkline-color-bottom")||"#333333";e.sparkline(e.data("sparkline-bar-val"),{type:"bar",width:s,height:d,barColor:ae,barWidth:o}),e.sparkline(e.data("sparkline-line-val"),{width:s,height:d,lineColor:r,lineWidth:c,composite:!0,fillColor:!1})}if("compositeline"==t){var d=e.data("sparkline-height")||"20px",s=e.data("sparkline-width")||"90px",de=e.data("sparkline-bar-val"),oe=e.data("sparkline-bar-val-spots-top")||null,ie=e.data("sparkline-bar-val-spots-bottom")||null,ne=e.data("sparkline-line-width-top")||1,le=e.data("sparkline-line-width-bottom")||1,se=e.data("sparkline-color-top")||"#333333",re=e.data("sparkline-color-bottom")||"#ed1c24",ce=e.data("sparkline-spotradius-top")||1.5,ue=e.data("sparkline-spotradius-bottom")||ce,m=e.data("sparkline-spot-color")||"#f08000",me=e.data("sparkline-minspot-color-top")||"#ed1c24",he=e.data("sparkline-maxspot-color-top")||"#f08000",pe=e.data("sparkline-minspot-color-bottom")||me,fe=e.data("sparkline-maxspot-color-bottom")||he,$e=e.data("sparkline-highlightspot-color-top")||"#50f050",ve=e.data("sparkline-highlightline-color-top")||"#f02020",ge=e.data("sparkline-highlightspot-color-bottom")||$e,be=e.data("sparkline-highlightline-color-bottom")||ve,we=e.data("sparkline-fillcolor-top")||"transparent",_e=e.data("sparkline-fillcolor-bottom")||"transparent";e.sparkline(de,{type:"line",spotRadius:ce,spotColor:m,minSpotColor:me,maxSpotColor:he,highlightSpotColor:$e,highlightLineColor:ve,valueSpots:oe,lineWidth:ne,width:s,height:d,lineColor:se,fillColor:we}),e.sparkline(e.data("sparkline-line-val"),{type:"line",spotRadius:ue,spotColor:m,minSpotColor:pe,maxSpotColor:fe,highlightSpotColor:ge,highlightLineColor:be,valueSpots:ie,lineWidth:le,width:s,height:d,lineColor:re,composite:!0,fillColor:_e})}}),$.fn.easyPieChart&&$(".easy-pie-chart").each(function(){var e=$(this),t=e.css("color")||e.data("pie-color"),a=e.data("pie-track-color")||"#eeeeee",d=parseInt(e.data("pie-size"))||25;e.easyPieChart({barColor:t,trackColor:a,scaleColor:!1,lineCap:"butt",lineWidth:parseInt(d/8.5),animate:1500,rotate:-90,size:d,onStep:function(e){this.$el.find("span").text(~~e)}})})}function setup_widgets_desktop(){$.fn.jarvisWidgets&&$.enableJarvisWidgets&&$("#widget-grid").jarvisWidgets({grid:"article",widgets:".jarviswidget",localStorage:!0,deleteSettingsKey:"#deletesettingskey-options",settingsKeyLabel:"Reset settings?",deletePositionKey:"#deletepositionkey-options",positionKeyLabel:"Reset position?",sortable:!0,buttonsHidden:!1,toggleButton:!0,toggleClass:"fa fa-minus | fa fa-plus",toggleSpeed:200,onToggle:function(){},deleteButton:!0,deleteClass:"fa fa-times",deleteSpeed:200,onDelete:function(){},editButton:!0,editPlaceholder:".jarviswidget-editbox",editClass:"fa fa-cog | fa fa-save",editSpeed:200,onEdit:function(){},colorButton:!0,fullscreenButton:!0,fullscreenClass:"fa fa-resize-full | fa fa-resize-small",fullscreenDiff:3,onFullscreen:function(){},customButton:!1,customClass:"folder-10 | next-10",customStart:function(){alert("Hello you, this is a custom button...")},customEnd:function(){alert("bye, till next time...")},buttonOrder:"%refresh% %custom% %edit% %toggle% %fullscreen% %delete%",opacity:1,dragHandle:"> header",placeholderClass:"jarviswidget-placeholder",indicator:!0,indicatorTime:600,ajax:!0,timestampPlaceholder:".jarviswidget-timestamp",timestampFormat:"Last update: %m%/%d%/%y% %h%:%i%:%s%",refreshButton:!0,refreshButtonClass:"fa fa-refresh",labelError:"Sorry but there was a error:",labelUpdated:"Last Update:",labelRefresh:"Refresh",labelDelete:"Delete widget:",afterLoad:function(){},rtl:!1,onChange:function(){},onSave:function(){},ajaxnav:$.navAsAjax})}function setup_widgets_mobile(){$.enableMobileWidgets&&$.enableJarvisWidgets&&setup_widgets_desktop()}function loadScript(e,t){if(jsArray[e])t&&t();else{jsArray[e]=!0;var a=document.getElementsByTagName("body")[0],d=document.createElement("script");d.type="text/javascript",d.src=e,d.onload=t,a.appendChild(d)}}function checkURL(){var e=location.hash.replace(/^#/,"");if(container=$("#content"),e){$("#left-panel nav li.active").removeClass("active"),$('#left-panel nav li:has(a[href="'+e+'"])').addClass("active");var t=$('#left-panel nav a[href="'+e+'"]').attr("title");document.title=t||document.title,loadURL(e+location.search,container)}else{var a=$('#left-panel nav > ul > li:first-child > a[href!="#"]');window.location.hash=a.attr("href")}}function loadURL(e,t){util.partialRedirect(e)}function drawBreadCrumb(){var e=$("#left-panel nav li.active > a"),t=e.length;$.bread_crumb.empty(),$.bread_crumb.append($("<li>Home</li>")),e.each(function(){$.bread_crumb.append($("<li></li>").html($.trim($(this).clone().children(".badge").remove().end().text()))),--t||(document.title=$.bread_crumb.find("li:last-child").text())})}function pageSetUp(){"desktop"===$.device?($("[rel=tooltip]").tooltip(),$("[rel=popover]").popover(),$("[rel=popover-hover]").popover({trigger:"hover"}),runAllCharts(),setup_widgets_desktop(),nav_page_height(),runAllForms()):($("[rel=popover]").popover(),$("[rel=popover-hover]").popover({trigger:"hover"}),runAllCharts(),setup_widgets_mobile(),nav_page_height(),runAllForms())}var app=new App,account_suggests,email_tags;$.throttle_delay=350,$.menu_speed=235,$.navbar_height=49,$.root_=$("body"),$.left_panel=$("#left-panel"),$.shortcut_dropdown=$("#shortcut"),$.bread_crumb=$("#ribbon ol.breadcrumb"),$.device=null;var path=window.location.pathname,role=$("#lbl-role-name").text();"Teacher"==role||"Student"==role?$.navAsAjax=!0:$.navAsAjax=!1,$.enableJarvisWidgets=!0,$.enableMobileWidgets=!1;var ismobile=/iphone|ipad|ipod|android|blackberry|mini|windows\sce|palm/i.test(navigator.userAgent.toLowerCase());ismobile?($.root_.addClass("mobile-detected"),$.device="mobile"):($.root_.addClass("desktop-detected"),$.device="desktop");var $add_school_validator,add_school_success_callback,$add_load_validator,add_load_changed,$manual_add_student_validator,add_student_changed,$invite_student_validator,add_method;App.prototype.bindApp=function(){function e(e,t,a,d){if(e&&e>0&&t&&t>0){$("#ddl-"+a+"-load-section").val(""),$("#ddl-"+a+"-load-section option").hide(),$("#ddl-"+a+"-load-section option[value=]").show(),$("#ddl-"+a+"-load-section option[value=0]").show();var o=0;$("#ddl-"+a+"-load-section option").each(function(){var a=$(this).data("school"),d=$(this).data("level");a==e&&d==t&&($(this).show(),o++)}),o>0?($(".new-section").hide(),$(".old-section").show(),$("#txt-"+a+"-load-section").rules("remove","required"),$("#ddl-"+a+"-load-section").rules("add","required"),$(".new-section").find(".wizard-container").find(".form-group").removeClass("has-error"),$(".new-section").find(".wizard-container").find(".form-group").removeClass("has-success")):($(".new-section").show(),$(".old-section").hide(),$("#ddl-"+a+"-load-section").val(""),$("#txt-"+a+"-load-section").rules("add","required"),$("#ddl-"+a+"-load-section").rules("remove","required"),$(".new-section").find(".wizard-container").find(".form-group").removeClass("has-error"),$(".new-section").find(".wizard-container").find(".form-group").removeClass("has-success")),d&&d()}}function a(e,t,a){$("#ddl-"+t+"-load-strand").val(""),e&&e>0?($("#ddl-"+t+"-load-strand").find("option").hide(),$("#ddl-"+t+"-load-strand").find("option[value=]").show(),$("#ddl-"+t+"-load-strand").find("option[value=0]").show(),$("#ddl-"+t+"-load-strand").find("option[data-track="+e+"]").show()):$("#ddl-"+t+"-load-strand").find("option").show(),a&&a()}function d(e,t,a,d){$("#ddl-"+a+"-load-level").val(""),e&&0!=e&&""!=e?($("#ddl-"+a+"-load-level optgroup").hide(),$("#ddl-"+a+"-load-section option").hide(),$("#ddl-"+a+"-load-section option[value=]").show(),$("#ddl-"+a+"-load-section option[value=0]").show(),curriculum.show(e,function(e){"OK"==e.status?e.result.curricular_classifications.forEach(function(e){$("#ddl-"+a+"-load-level optgroup[data-id="+e.id+"]").show(),$("#ddl-"+a+"-load-section option[data-curricular-classification="+e.id+"]").show()}):($("#ddl-"+a+"-load-level optgroup").show(),$("#ddl-"+a+"-load-section option").show()),d&&d()})):t&&t.length>0&&($("#ddl-"+a+"-load-level optgroup").hide(),$("#ddl-"+a+"-load-section option").hide(),t.forEach(function(e){$("#ddl-"+a+"-load-level optgroup[data-id="+e+"]").show(),$("#ddl-"+a+"-load-section option[data-id="+e+"]").show()}),d&&d())}function o(e){"SENIOR HIGH"==$("#ddl-"+e+"-load-level").find("option:selected").data("curricular-classification-name").toUpperCase()?($(".senior-high").show(),$(".college").hide(),$("#ddl-"+e+"-load-program").val("")):"TERTIARY"==$("#ddl-"+e+"-load-level").find("option:selected").data("curricular-classification-name").toUpperCase()?($(".senior-high").hide(),$(".college").show(),$("#ddl-"+e+"-load-track").val(""),$("#ddl-"+e+"-load-strand").val("")):($(".senior-high").hide(),$(".college").hide(),$("#ddl-"+e+"-load-track").val(""),$("#ddl-"+e+"-load-strand").val(""),$("#ddl-"+e+"-load-program").val(""))}function e(e,t,a,d){if(e&&e>0&&t&&t>0){$("#ddl-"+a+"-load-section").val(""),$("#ddl-"+a+"-load-section option").hide(),$("#ddl-"+a+"-load-section option[value=]").show(),$("#ddl-"+a+"-load-section option[value=0]").show();var o=0;$("#ddl-"+a+"-load-section option").each(function(){var a=$(this).data("school"),d=$(this).data("level");a==e&&d==t&&($(this).show(),o++)}),o>0?($(".new-section").hide(),$(".old-section").show(),$("#txt-"+a+"-load-section").rules("remove","required"),$("#ddl-"+a+"-load-section").rules("add","required"),$(".new-section").find(".wizard-container").find(".form-group").removeClass("has-error"),$(".new-section").find(".wizard-container").find(".form-group").removeClass("has-success")):($(".new-section").show(),$(".old-section").hide(),$("#ddl-"+a+"-load-section").val(""),$("#txt-"+a+"-load-section").rules("add","required"),$("#ddl-"+a+"-load-section").rules("remove","required"),$(".new-section").find(".wizard-container").find(".form-group").removeClass("has-error"),$(".new-section").find(".wizard-container").find(".form-group").removeClass("has-success")),d&&d()}}function a(e,t,a){$("#ddl-"+t+"-load-strand").val(""),e&&e>0?($("#ddl-"+t+"-load-strand").find("option").hide(),$("#ddl-"+t+"-load-strand").find("option[value=]").show(),$("#ddl-"+t+"-load-strand").find("option[value=0]").show(),$("#ddl-"+t+"-load-strand").find("option[data-track="+e+"]").show()):$("#ddl-"+t+"-load-strand").find("option").show(),a&&a()}function i(){var e=[],t=["A","B","C","D","E","F","G","H"],a=["Juan","Joan"],d=["Doe","Dela Cruz"],o=["Dela Cruz","Doe"],i=["juan.delacruz@email.com","joan.doe@email.com"],n=["Male","Female"],l=["Yes","No"],s=["Yes","No"],r=["Yes","No"];$("#tbl-import-students-csv-columns tbody tr").each(function(){tds=$(this).find("td"),$(tds[1]).find("input[type=checkbox]").prop("checked")&&e.push($(tds[2]).text().replace("4","Four"))}),$("#tbl-import-students-csv-preview thead tr").empty().append('<th class="text-center"></th>');var c=0;e.forEach(function(e){$("#tbl-import-students-csv-preview thead tr").append('<th class="text-center">'+t[c]+"</th>"),c++}),$("#tbl-import-students-csv-preview tbody tr:first-child").empty().append('<td class="text-center">1</td>'),e.forEach(function(e){$("#tbl-import-students-csv-preview tbody tr:first-child").append('<td class="text-center"><strong>'+e.replace(" ","")+"</strong></td>")}),$("#tbl-import-students-csv-preview tbody tr:nth-child(2)").empty().append('<td class="text-center">2</td>'),e.forEach(function(e){"FIRST NAME"==e.toUpperCase()?$("#tbl-import-students-csv-preview tbody tr:nth-child(2)").append("<td>"+a[0]+"</td>"):"MIDDLE NAME"==e.toUpperCase()?$("#tbl-import-students-csv-preview tbody tr:nth-child(2)").append("<td>"+d[0]+"</td>"):"LAST NAME"==e.toUpperCase()?$("#tbl-import-students-csv-preview tbody tr:nth-child(2)").append("<td>"+o[0]+"</td>"):"EMAIL"==e.toUpperCase()?$("#tbl-import-students-csv-preview tbody tr:nth-child(2)").append("<td>"+i[0]+"</td>"):"GENDER"==e.toUpperCase()?$("#tbl-import-students-csv-preview tbody tr:nth-child(2)").append("<td>"+n[0]+"</td>"):"FOURPS"==e.toUpperCase()?$("#tbl-import-students-csv-preview tbody tr:nth-child(2)").append("<td>"+l[0]+"</td>"):"BALIK ARAL"==e.toUpperCase()?$("#tbl-import-students-csv-preview tbody tr:nth-child(2)").append("<td>"+s[0]+"</td>"):"REPEATER"==e.toUpperCase()&&$("#tbl-import-students-csv-preview tbody tr:nth-child(2)").append("<td>"+r[0]+"</td>")}),$("#tbl-import-students-csv-preview tbody tr:nth-child(3)").empty().append('<td class="text-center">3</td>'),e.forEach(function(e){"FIRST NAME"==e.toUpperCase()?$("#tbl-import-students-csv-preview tbody tr:nth-child(3)").append("<td>"+a[1]+"</td>"):"MIDDLE NAME"==e.toUpperCase()?$("#tbl-import-students-csv-preview tbody tr:nth-child(3)").append("<td>"+d[1]+"</td>"):"LAST NAME"==e.toUpperCase()?$("#tbl-import-students-csv-preview tbody tr:nth-child(3)").append("<td>"+o[1]+"</td>"):"EMAIL"==e.toUpperCase()?$("#tbl-import-students-csv-preview tbody tr:nth-child(3)").append("<td>"+i[1]+"</td>"):"GENDER"==e.toUpperCase()?$("#tbl-import-students-csv-preview tbody tr:nth-child(3)").append("<td>"+n[1]+"</td>"):"FOURPS"==e.toUpperCase()?$("#tbl-import-students-csv-preview tbody tr:nth-child(3)").append("<td>"+l[1]+"</td>"):"BALIK ARAL"==e.toUpperCase()?$("#tbl-import-students-csv-preview tbody tr:nth-child(3)").append("<td>"+s[1]+"</td>"):"REPEATER"==e.toUpperCase()&&$("#tbl-import-students-csv-preview tbody tr:nth-child(3)").append("<td>"+r[1]+"</td>")})}function n(){$("#modal-add-students tbody tr:last-child .first-name-student").unbind().keyup(function(){var e=$("#modal-add-students .male tbody tr:last-child .first-name-student"),t=$("#modal-add-students .female tbody tr:last-child .first-name-student");e.val().trim()&&$("#lnk-add-students-add-male-student").click(),t.val().trim()&&$("#lnk-add-students-add-female-student").click()})}function l(e){clone=$("#modal-add-students .manual-container .students."+e).find("tbody tr").clone(),clone.find(".form-group").removeClass("has-error has-success"),clone.find(".help-block").remove();var t=clone[0].innerHTML;$("#modal-add-students .manual-container .students."+e).find("tbody").append("<tr data-gender="+e+">"+t.replace("<center></center>",'<center><a class="btn btn-sm btn-danger student-delete"><i class="fa fa-trash-o"></i></a></center>')+"</tr>"),$("#modal-add-students .manual-container .students."+e).find("tbody tr:last-child .student-delete").on("click",function(){$(this).parent().parent().parent().remove(),n()}),n(),$("#modal-add-students .manual-container .students."+e+" tbody tr:last-child .first-name-student").prop("name","student_first_name_"+$(".students").find("tbody tr").length),$("#modal-add-students .manual-container .students."+e+" tbody tr:last-child .middle-name-student").prop("name","student_middle_name_"+$(".students").find("tbody tr").length),$("#modal-add-students .manual-container .students."+e+" tbody tr:last-child .last-name-student").prop("name","student_last_name_"+$(".students").find("tbody tr").length),$("#modal-add-students .manual-container .students."+e+" tbody tr:last-child .email-student").prop("name","student_email_"+$(".students").find("tbody tr").length),$("#frm-add-students").validate(),$("#modal-add-students ."+e+" tbody tr:last-child .first-name-student").rules("add",{required:!0,messages:{required:"Please enter the first name."}}),$("#modal-add-students ."+e+" tbody tr:last-child .middle-name-student").rules("add",{required:!0,messages:{required:"Please enter the midle name."}}),$("#modal-add-students ."+e+" tbody tr:last-child .last-name-student").rules("add",{required:!0,messages:{required:"Please enter the last name."}}),$("#modal-add-students ."+e+" tbody tr:last-child .email-student").rules("add",{email:!0,messages:{email:"Please enter a valid email."}})}function s(e){row_count=$("#modal-add-students .manual-container .students."+e+" tbody tr").length,last_row=$("#modal-add-students .manual-container .students."+e+" tbody tr:last-child");var t=last_row.find(".first-name-student").val(),a=(last_row.find(".middle-name-student").val(),last_row.find(".last-name-student").val());1==row_count||$.trim(t)||$.trim(a)||(last_row.remove(),n())}function r(e){var t=$(e).data("role-plan-id"),a=$("#switch-privilege a").data("assignment-id");$("#modal-pay-now .link-option.paypal").attr("href","/paypal/ec-checkout?mode=recurring&role_plan_id="+t+"&assignment_id="+a),$("#hdn-pay-with-card-role-plan-id").val(t),$("#hdn-pay-with-card-assignment-id").val(t),$("#modal-pay-now .switch-plan-container").hide(),$("#modal-pay-now .cancel-plan-container").hide(),$("#modal-pay-now .change-method-container").hide(),$("#modal-pay-now .options-container").hide(),$("#modal-pay-now .card-container").hide(),$("#modal-pay-now .card-container .alert-success").hide(),$("#modal-pay-now .card-container .alert-danger").hide(),$("#modal-pay-now .card-container .form-control").val(""),$("#modal-pay-now .card-container .form-group").removeClass("has-error"),h.resetForm()}"undefined"!=typeof no_menu&&no_menu&&$("#modal-set-menus").modal("show"),$(".usage-check").unbind("change").on("change",function(){var e=!1;$(".usage-check").each(function(){$(this).prop("checked")&&(e=!0)}),e?$("#hdn-set-usage-selected").val(1):$("#hdn-set-usage-selected").val("")}),$("#frm-set-usage").unbind("submit").on("submit",function(e){e.preventDefault();var t=$("#frm-set-usage").valid();if(!t)return c.focusInvalid(),!1;var a=$("#hdn-logged-in-assignment-id").val(),d=[];$(".usage-check").each(function(){$(this).prop("checked")&&d.push($(this).data("id"))});var o={id:a,menus:d,path:window.location.pathname};$("#btn-set-menus").attr("disabled","disabled").find("i").removeClass("fa-save").addClass("fa-cog").addClass("fa-spin"),assignment.storeMenus(o,function(e){"OK"==e.status?window.location.reload():$("#modal-set-menus").find(".alert-danger").html('<i class="fa fa-times"></i> '+e.error).show()})});var c=$("#frm-set-usage").validate({ignore:[],rules:{set_usage_selected:{required:!0}},messages:{set_usage_selected:"Please select at least one option."},highlight:function(e){$(e).closest(".form-group").removeClass("has-success").addClass("has-error")},unhighlight:function(e){$(e).closest(".form-group").removeClass("has-error").addClass("has-success")},errorElement:"span",errorClass:"help-block",errorPlacement:function(e,t){t.parent(".input-group").length?e.insertAfter(t.parent()):e.insertAfter(t)}});app.bindNotifications(),app.bindNotices(),$(".header-search").unbind("submit"),$(".person-main-autocomplete").autocomplete({serviceUrl:"/persons/ajaxShowPersons",appendTo:$(".person-main-autocomplete").parent().parent(),forceFixPosition:!0,html:!0,showNoSuggestionNotice:!0,noSuggestionNotice:"<center>No results found</center>",onSelect:function(e){window.location.href="/persons/"+e.id},onSearchComplete:function(){},formatResult:function(e,t){var a="("+t.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&")+")";console.log(e);var d;return d=e.image&&""!=e.image?e.image:"/plugins/smartadmin/img/avatars/"+e.gender+".png",'<div class="row"><div class="col-xs-2"><img class="thumbnail-sm" src="'+d+'" /></div><div class="col-xs-10"><div class="name"><b>'+e.value.replace(new RegExp(a,"gi"),"<strong>$1</strong>")+'</b></div><div class="desc"><span>'+(e.role?e.role.name:"")+(e.school?", "+e.school.name:"")+"</span></div></div></div>"}}),$("#ddl-main-load").on("change",function(){var e=$("#ddl-main-load").val();"add"==e?($(".add-load").click(),$("#ddl-main-load").val("")):(url=window.location.pathname,url=url.split("/"),role_name=$("#lbl-role-name").text().toLowerCase(),"loads"===url[1]&&void 0!==url[2]?""===e?window.location.href="student"==role_name?"/classes":"/loads":window.location.href="/"+url[1]+"/"+e:($("#frm-main-load").attr("action",window.location.pathname),$("#frm-main-load").submit()))}),$("#frm-main-load").unbind("submit").on("submit",function(e){e.preventDefault();var t=$("#ddl-main-load").val(),a=window.location.pathname+"?main_load="+t;util.partialRedirect(a)}),edit_load_changed=!1,$(".load-edit").unbind("click").on("click",function(){var t=$(this).data("id");$("#modal-edit-load").find(".alert-danger").hide(),$("#frm-edit-load").prop("action","loads/"+t),$("#hdn-edit-load-id").val(t),$("#modal-edit-load .form-group").removeClass("has-error").removeClass("has-success"),$("#modal-edit-load").find(".wizard-container").show(),$("#modal-edit-load").find(".complete-container").hide(),$("#modal-edit-load").find(".saving-container").hide(),$("#modal-edit-load").find(".error-container").hide(),$("#modal-edit-load").find(".incomplete-container").hide(),$("#modal-edit-load").find(".cancel-container").hide(),$("#modal-edit-load").find(".no-change-container").hide(),$("#wizard-edit-load").bootstrapWizard("first");var o=1;$("#wizard-edit-load").find(".form-wizard").find("li").each(function(){$(this).removeClass("complete"),$(this).find(".step").html(o),o++}),$("#modal-edit-load").find(".wizard-container").find(".form-group").removeClass("has-error"),$("#modal-edit-load").find(".wizard-container").find(".form-group").removeClass("has-success"),$("#modal-edit-load").find(".wizard-container").find("select.form-control").each(function(){var e=$(this).find("option[data-current=1]").prop("value");$(this).val(e)}),$(".schedule-delete").each(function(){$(this).click()}),$(".new-section").hide(),$(".old-section").show(),$(".senior-high").hide(),$(".college").hide(),$(".new-section").find(".wizard-container").find(".form-group").removeClass("has-error"),$(".new-section").find(".wizard-container").find(".form-group").removeClass("has-success"),$("#ddl-edit-load-section").find("option").show(),$("#ddl-edit-load-strand").find("option").show(),$("#modal-edit-load .form-control").on("change",function(){edit_load_changed=!0}),$("#modal-edit-load .schedule .btn").on("click",function(){edit_load_changed=!0}),load.show(t,function(t){if("OK"==t.status){var o=$("#hdn-school-id").val();if(t.load.school_curriculum_step_subject){$("#ddl-edit-load-curriculum").select2("val",t.load.school_curriculum_step_subject.curriculum_step_subject.curriculum_step.curriculum.id).on("change",function(){edit_load_changed=!0}),d(t.load.school_curriculum_step_subject.curriculum_step_subject.curriculum_step.curriculum.id,null,"edit",null),$("#ddl-edit-load-subject").select2("val",t.load.school_curriculum_step_subject.curriculum_step_subject.subject.id).on("change",function(){edit_load_changed=!0}),$("#ddl-edit-load-academic-calendar-year").val(t.load.school_calendar_term.school_calendar_year.academic_calendar_year.id),$("#ddl-edit-load-term").val(t.load.school_calendar_term.school_term.term.id),$("#ddl-edit-load-level").val(t.load.block.school_level.level.id),e(o,t.load.block.school_level.level.id,"edit",function(){$("#ddl-edit-load-section").val(t.load.block.id)}),t.load.school_curriculum_step_subject.school_curriculum_step.curriculum_step.track?($("#ddl-edit-load-track").val(t.load.school_curriculum_step_subject.school_curriculum_step.curriculum_step.track.id),a(t.load.school_curriculum_step_subject.school_curriculum_step.curriculum_step.track.id,"edit",function(){t.load.school_curriculum_step_subject.school_curriculum_step.curriculum_step.strand&&$("#ddl-edit-load-strand").val(t.load.school_curriculum_step_subject.school_curriculum_step.curriculum_step.strand.id)}),$(".senior-high").show(),$(".college").hide()):t.load.school_curriculum_step_subject.school_curriculum_step.curriculum_step.program&&($("#ddl-edit-load-program").val(t.load.school_curriculum_step_subject.school_curriculum_step.curriculum_step.program.id),$(".senior-high").hide(),$(".college").show());var i=0;$("#wizard-edit-load .schedule tbody").empty(),t.load.schedules.forEach(function(e){var a,d=!1;if($("#wizard-edit-load .schedule tbody > tr").each(function(){var t=util.getTime($(this).find(".from-schedule")),o=util.getTime($(this).find(".to-schedule"));t==e.start_time&&o==e.end_time&&(d=!0,a=$(this).find("select.day-schedule"))}),d)$(a).select2("val",$(a).select2("val").concat(e.day_of_week.id));else{if($("#wizard-edit-load .schedule tbody").append('<tr data-id="1"><td><div class="form-group"><select name="schedule_day_1" data-id="1" class="select-multiple day-schedule" multiple></select></div></td><td><div class="form-group"><div class="input-group"><input class="form-control from-schedule" data-id="1" name="schedule_from_1" type="text" placeholder="From"><span class="input-group-addon"><i class="fa fa-clock-o"></i></span></div></div></td><td><center>-</center></td><td><div class="form-group"><div class="input-group"><input class="form-control to-schedule" data-id="1" name="schedule_to_1" type="text" placeholder="To"><span class="input-group-addon"><i class="fa fa-clock-o"></i></span></div></div></td><td><center></center></td></tr>'),t.day_of_weeks.forEach(function(t){$("#wizard-edit-load .schedule tbody tr:last-child select.day-schedule").append('<option value="'+t.id+'" '+(t.id==e.day_of_week.id?"selected":"")+" >"+t.name+"</option>")}),i>0){var o=$("#wizard-edit-load .schedule tbody tr:last-child").html();$("#wizard-edit-load .schedule tbody tr:last-child").html(o.replace("<center></center>",'<center><a class="btn btn-sm btn-danger schedule-delete"><i class="fa fa-trash-o"></i></a></center>')),$("#wizard-edit-load .schedule tbody tr:last-child .schedule-delete").on("click",function(){$(this).parent().parent().parent().remove(),$("#modal-edit-load select.day-schedule").valid(),
$("#modal-edit-load .from-schedule").valid(),$("#modal-edit-load .to-schedule").valid(),edit_load_changed=!0})}$("#modal-edit-load tbody tr:last-child .select2-container").remove(),$("#modal-edit-load .schedule tbody tr:last-child select.day-schedule").select2().on("change",function(e){$("#modal-edit-load select.day-schedule").valid(),$("#modal-edit-load .from-schedule").valid(),$("#modal-edit-load .to-schedule").valid(),edit_load_changed=!0}),$("#modal-edit-load .schedule").find("tbody tr:last-child .from-schedule").timepicker({defaultTime:util.timeFormat12Hour(e.start_time)}).on("changeTime.timepicker",function(){$("#modal-edit-load .schedule tbody tr").find("select.day-schedule").valid(),$("#modal-edit-load .schedule tbody tr").find(".from-schedule").valid(),$("#modal-edit-load .schedule tbody tr").find(".to-schedule").valid(),edit_load_changed=!0}),$("#modal-edit-load .schedule").find("tbody tr:last-child .to-schedule").timepicker({defaultTime:util.timeFormat12Hour(e.end_time)}).on("changeTime.timepicker",function(){$("#modal-edit-load .schedule tbody tr").find("select.day-schedule").valid(),$("#modal-edit-load .schedule tbody tr").find(".from-schedule").valid(),$("#modal-edit-load .schedule tbody tr").find(".to-schedule").valid(),edit_load_changed=!0}),$("#wizard-edit-load .schedule tbody tr:last-child .from-schedule").val(util.timeFormat12Hour(e.start_time)),$("#wizard-edit-load .schedule tbody tr:last-child .to-schedule").val(util.timeFormat12Hour(e.end_time)),$("#wizard-edit-load .schedule tbody tr:last-child .form-control").on("change",function(){$(this).valid(),edit_load_changed=!0}),$("#modal-edit-load .schedule").find("tbody tr:last-child .schedule-delete").on("click",function(){$(this).parent().parent().parent().remove(),$("#modal-edit-load select.day-schedule").valid(),$("#modal-edit-load .from-schedule").valid(),$("#modal-edit-load .to-schedule").valid()}),$("#modal-edit-load tbody tr:last-child select.day-schedule").prop("name","schedule_day_"+$(".schedule").find("tbody tr").length),$("#modal-edit-load tbody tr:last-child .from-schedule").prop("name","schedule_from_"+$(".schedule").find("tbody tr").length),$("#modal-edit-load tbody tr:last-child .to-schedule").prop("name","schedule_to_"+$(".schedule").find("tbody tr").length),$("#modal-edit-load tbody tr:last-child").attr("data-id",$(".schedule").find("tbody tr").length),$("#modal-edit-load tbody tr:last-child select.day-schedule").attr("data-id",$(".schedule").find("tbody tr").length),$("#modal-edit-load tbody tr:last-child .from-schedule").attr("data-id",$(".schedule").find("tbody tr").length),$("#modal-edit-load tbody tr:last-child .to-schedule").attr("data-id",$(".schedule").find("tbody tr").length),$("#frm-edit-load").validate(),$("#modal-edit-load tbody tr:last-child select.day-schedule").rules("add","required"),$("#modal-edit-load tbody tr:last-child .from-schedule").rules("add","required"),$("#modal-edit-load tbody tr:last-child .to-schedule").rules("add","required"),$("#modal-edit-load tbody tr:last-child select.day-schedule").rules("add","edit_unique_schedule"),$("#modal-edit-load tbody tr:last-child .from-schedule").rules("add","edit_unique_schedule"),$("#modal-edit-load tbody tr:last-child .to-schedule").rules("add","edit_unique_schedule"),$("#modal-edit-load tbody tr:last-child .from-schedule").rules("add","edit_range"),$("#modal-edit-load tbody tr:last-child .to-schedule").rules("add","edit_range"),i++}})}else{$("#modal-edit-load").find(".wizard-container").show(),$("#modal-edit-load").find(".complete-container").hide(),$("#modal-edit-load").find(".saving-container").hide(),$("#modal-edit-load").find(".error-container").hide(),$("#modal-edit-load").find(".overlimit-container").hide(),$("#modal-edit-load").find(".incomplete-container").hide(),$("#modal-edit-load").find(".cancel-container").hide(),$("#modal-edit-load").find(".wizard-container").find(".select-single").select2("val",""),$("#modal-edit-load").find(".wizard-container").find(".select-multiple").select2("val",""),$("#wizard-edit-load").bootstrapWizard("first");var i=1;$("#wizard-edit-load").find(".form-wizard").find("li").each(function(){$(this).removeClass("complete"),$(this).find(".step").html(i),i++}),$("#modal-edit-load").find(".wizard-container").find(".form-group").removeClass("has-error"),$("#modal-edit-load").find(".wizard-container").find(".form-group").removeClass("has-success"),u.resetForm(),$("#modal-edit-load .from-schedule").timepicker("setTime",util.getCurrentEstimatedTime()).on("changeTime.timepicker",function(){$("#modal-edit-load .schedule tbody tr").find("select.day-schedule").valid(),$("#modal-edit-load .schedule tbody tr").find(".from-schedule").valid(),$("#modal-edit-load .schedule tbody tr").find(".to-schedule").valid()}),$("#modal-edit-load .to-schedule").timepicker("setTime",util.getCurrentEstimatedTime(1,0,0)).on("changeTime.timepicker",function(){$("#modal-edit-load .schedule tbody tr").find("select.day-schedule").valid(),$("#modal-edit-load .schedule tbody tr").find(".from-schedule").valid(),$("#modal-edit-load .schedule tbody tr").find(".to-schedule").valid()}),$("#modal-edit-load").find(".wizard-container").find("select.form-control").each(function(){var e=$(this).find("option[data-current=1]").prop("value");e||$(this).val("")}),$(".schedule-delete").each(function(){$(this).click()}),$(".new-section").hide(),$(".old-section").show(),$(".senior-high").hide(),$(".college").hide(),$("#txt-edit-load-section").rules("remove","required"),$("#ddl-edit-load-section").rules("add","required"),$(".new-section").find(".wizard-container").find(".form-group").removeClass("has-error"),$(".new-section").find(".wizard-container").find(".form-group").removeClass("has-success"),$("#ddl-edit-load-section").find("option").show(),$("#ddl-edit-load-strand").find("option").show(),$("#modal-edit-load .form-control, #modal-edit-load .select-single").on("change",function(){edit_load_changed=!0}),$("#modal-edit-load .schedule .btn").on("click",function(){edit_load_changed=!0}),edit_load_changed=!1,$("#ddl-edit-load-subject").bind()}edit_load_changed=!1}else $("#modal-edit-load").find(".alert-danger").html('<i class="fa fa-times"></i> '+t.error).show()})}),$("#wizard-edit-load").bootstrapWizard({tabClass:"form-wizard",onNext:function(e,t,a){var d=$("#frm-edit-load").valid();if(!d)return $("#wizard-edit-load").find(".form-wizard").children("li").eq(a-1).removeClass("complete"),$("#wizard-edit-load").find(".form-wizard").children("li").eq(a-1).find(".step").html(a),!1;$("#wizard-edit-load").find(".form-wizard").children("li").eq(a-1).addClass("complete"),$("#wizard-edit-load").find(".form-wizard").children("li").eq(a-1).find(".step").html('<i class="fa fa-check"></i>');var o=$("#wizard-edit-load").find(".complete").length;3==o?($("#modal-edit-load").find(".wizard-container").hide(),edit_load_changed?$("#modal-edit-load").find(".complete-container").show():$("#modal-edit-load").find(".no-change-container").show()):3==a&&($("#modal-edit-load").find(".wizard-container").hide(),$("#modal-edit-load").find(".incomplete-container").show())}}),$("#modal-edit-load .wizard-back").unbind("click").on("click",function(){$("#modal-edit-load .wizard-container").show(),$("#modal-edit-load .modal-footer").show(),$("#modal-edit-load .complete-container").hide(),$("#modal-edit-load .incomplete-container").hide(),$("#modal-edit-load .cancel-container").hide(),$("#modal-edit-load .no-change-container").hide()}),$("#modal-edit-load .cancel").unbind("click").on("click",function(){edit_load_changed?($("#modal-edit-load .cancel-container").show(),$("#modal-edit-load .wizard-container").hide(),$("#modal-edit-load .modal-footer").hide()):$("#modal-edit-load").modal("hide")});var u=$("#frm-edit-load").validate({rules:{subject_id:{required:!0},school_calendar_year:{required:!0},school_calendar_term:{required:!0},student_level:{required:!0},schedule_day_1:{required:!0,edit_unique_schedule:!0},schedule_from_1:{required:!0,edit_unique_schedule:!0,edit_range:!0},schedule_to_1:{required:!0,edit_unique_schedule:!0,edit_range:!0}},messages:{subject_id:"Please select a subject.",school_calendar_year:"Please select a school year.",school_calendar_term:"Please select a school term.",student_level:"Please select a student level."},highlight:function(e){$(e).closest(".form-group").removeClass("has-success").addClass("has-error")},unhighlight:function(e){$(e).closest(".form-group").removeClass("has-error").addClass("has-success")},errorElement:"span",errorClass:"help-block",errorPlacement:function(e,t){t.parent(".input-group").length?e.insertAfter(t.parent()):e.insertAfter(t)}});$.validator.addMethod("edit_unique_schedule",function(e,t){var a=!0,d=$(t).attr("data-id"),o=$("#modal-edit-load .schedule tbody tr[data-id="+d+"]").find("select.day-schedule").val(),i=util.getTime($("#modal-edit-load .schedule tbody tr[data-id="+d+"]").find(".from-schedule")),n=util.getTime($("#modal-edit-load .schedule tbody tr[data-id="+d+"]").find(".to-schedule")),l=[];return $("#modal-edit-load .schedule").find("tbody tr").each(function(){var e=$(this).find("select.day-schedule").val(),t=util.getTime($(this).find(".from-schedule")),a=util.getTime($(this).find(".to-schedule"));e&&e.forEach(function(e){l.push({day_of_week:e,start_time:t,end_time:a})})}),o?(o.forEach(function(e){var t=0;l.forEach(function(a){e==a.day_of_week&&i==a.start_time&&n==a.end_time&&t++}),t>1&&(a=!1)}),a):!0},"Duplicate schedules are not allowed."),$.validator.addMethod("edit_range",function(e,t){var a=$(t).attr("data-id"),d=!0;return $("#modal-edit-load .schedule").find("tbody tr[data-id="+a+"]").each(function(){var e=util.getTime($(this).find(".from-schedule")),t=util.getTime($(this).find(".to-schedule"));e>=t&&(d=!1)}),d},"Please input a valid range of time."),$("#modal-edit-load").on("shown.bs.modal",function(){$("#ddl-edit-load-subject").trigger("change"),$("#ddl-edit-load-subject").unbind("change").on("change",function(){0==$(this).val()?$(".new-subject").show():$(".new-subject").hide()}),$("#ddl-edit-load-curriculum").trigger("change"),$("#ddl-edit-load-curriculum").unbind("change").on("change",function(){0==$(this).val()?$(".new-curriculum").show():$(".new-curriculum").hide();var e=$(this).val();d(e,null,"edit",null),$("#msl-edit-load-curricular-classifications").unbind("change").on("change",function(){var e=$(this).val();d(null,e,"edit",null)})})}),$("#lnk-edit-load-add-schedule").unbind("click").on("click",function(){var e=$("#modal-edit-load .schedule").find("tbody tr")[0].innerHTML;$("#modal-edit-load .schedule").find("tbody").append("<tr>"+e.replace("<center></center>",'<center><a class="btn btn-sm btn-danger schedule-delete"><i class="fa fa-trash-o"></i></a></center>')+"</tr>"),$("#modal-edit-load tbody tr:last-child select.day-schedule").parent().find(".help-block").remove(),$("#modal-edit-load tbody tr:last-child .from-schedule").parent().parent().find(".help-block").remove(),$("#modal-edit-load tbody tr:last-child .to-schedule").parent().parent().find(".help-block").remove(),$("#modal-edit-load tbody tr:last-child select.day-schedule").parent().removeClass("has-error").removeClass("has-success"),$("#modal-edit-load tbody tr:last-child .from-schedule").parent().parent().removeClass("has-error").removeClass("has-success"),$("#modal-edit-load tbody tr:last-child .to-schedule").parent().parent().removeClass("has-error").removeClass("has-success"),$("#modal-edit-load .schedule").find("tbody tr:last-child .from-schedule").timepicker("setTime",util.getCurrentEstimatedTime()).on("changeTime.timepicker",function(){$("#modal-edit-load .schedule tbody tr").find("select.day-schedule").valid(),$("#modal-edit-load .schedule tbody tr").find(".from-schedule").valid(),$("#modal-edit-load .schedule tbody tr").find(".to-schedule").valid(),edit_load_changed=!0}),$("#modal-edit-load .schedule").find("tbody tr:last-child .to-schedule").timepicker("setTime",util.getCurrentEstimatedTime(1,0,0)).on("changeTime.timepicker",function(){$("#modal-edit-load .schedule tbody tr").find("select.day-schedule").valid(),$("#modal-edit-load .schedule tbody tr").find(".from-schedule").valid(),$("#modal-edit-load .schedule tbody tr").find(".to-schedule").valid(),edit_load_changed=!0}),$("#modal-edit-load .schedule").find("tbody tr:last-child .schedule-delete").on("click",function(){$(this).parent().parent().parent().remove(),$("#modal-edit-load select.day-schedule").valid(),$("#modal-edit-load .from-schedule").valid(),$("#modal-edit-load .to-schedule").valid(),edit_load_changed=!0}),$("#modal-edit-load tbody tr:last-child .select2-container").remove(),$("#modal-edit-load tbody tr:last-child select.day-schedule").val("").select2().on("change",function(e){$("#modal-edit-load select.day-schedule").valid(),$("#modal-edit-load .from-schedule").valid(),$("#modal-edit-load .to-schedule").valid(),edit_load_changed=!0}),$("#modal-edit-load tbody tr:last-child select.day-schedule").prop("name","schedule_day_"+$(".schedule").find("tbody tr").length),$("#modal-edit-load tbody tr:last-child .from-schedule").prop("name","schedule_from_"+$(".schedule").find("tbody tr").length),$("#modal-edit-load tbody tr:last-child .to-schedule").prop("name","schedule_to_"+$(".schedule").find("tbody tr").length),$("#modal-edit-load tbody tr:last-child").attr("data-id",$(".schedule").find("tbody tr").length),$("#modal-edit-load tbody tr:last-child select.day-schedule").attr("data-id",$(".schedule").find("tbody tr").length),$("#modal-edit-load tbody tr:last-child .from-schedule").attr("data-id",$(".schedule").find("tbody tr").length),$("#modal-edit-load tbody tr:last-child .to-schedule").attr("data-id",$(".schedule").find("tbody tr").length),$("#frm-edit-load").validate(),$("#modal-edit-load tbody tr:last-child select.day-schedule").rules("add","required"),$("#modal-edit-load tbody tr:last-child .from-schedule").rules("add","required"),$("#modal-edit-load tbody tr:last-child .to-schedule").rules("add","required"),$("#modal-edit-load tbody tr:last-child select.day-schedule").rules("add","edit_unique_schedule"),$("#modal-edit-load tbody tr:last-child .from-schedule").rules("add","edit_unique_schedule"),$("#modal-edit-load tbody tr:last-child .to-schedule").rules("add","edit_unique_schedule"),$("#modal-edit-load tbody tr:last-child .from-schedule").rules("add","edit_range"),$("#modal-edit-load tbody tr:last-child .to-schedule").rules("add","edit_range")}),$("#ddl-edit-load-level").unbind("change").on("change",function(){var t=$(this).val(),a=$("#hdn-school-id").val();e(a,t,"edit",null),o("edit")}),$("#ddl-edit-load-section").unbind("change").on("change",function(){var e=$(this).find(":selected").data("level");0==$(this).val()?($("#modal-edit-load .new-section").show(),$("#txt-add-load-section").rules("add","required"),$("#modal-edit-load .new-section").find(".wizard-container").find(".form-group").removeClass("has-error"),$("#modal-edit-load .new-section").find(".wizard-container").find(".form-group").removeClass("has-success")):($("#modal-edit-load .new-section").hide(),$("#txt-add-load-section").rules("remove","required"),$("#modal-edit-load .new-section").find(".wizard-container").find(".form-group").removeClass("has-error"),$("#modal-edit-load .new-section").find(".wizard-container").find(".form-group").removeClass("has-success"),$("#ddl-edit-load-level").val(e))}),$("#ddl-edit-load-track").unbind("change").on("change",function(){var e=$(this).val();a(e,"edit",null)}),$("#ddl-edit-load-strand").on("change",function(){var e=$(this).find(":selected").data("track");$("#ddl-edit-load-track").val(e)}),$("#modal-edit-load .wizard-save").unbind("click").on("click",function(){$("#modal-edit-load .complete-container").hide(),$("#modal-edit-load .saving-container").show();var e=[];new Date;$("#modal-edit-load .schedule").find("tbody tr").each(function(){var t=$(this).find("select.day-schedule").val(),a=util.getTime($(this).find(".from-schedule")),d=util.getTime($(this).find(".to-schedule"));t.forEach(function(t){e.push({day_of_week:t,start_time:a,end_time:d})})});var t=$("#hdn-edit-load-id").val(),a={id:$("#hdn-school-id").val()},d={id:$("#ddl-edit-load-curriculum").val()},o={id:$("#ddl-edit-load-subject").val()},i={id:$("#ddl-edit-load-academic-calendar-year").val()},n={id:$("#ddl-edit-load-term").find(":selected").data("term-category")},l={id:$("#ddl-edit-load-term").val()},s={id:$("#ddl-edit-load-level").find(":selected").data("curricular-classification-id")},r={id:$("#ddl-edit-load-level").val()},c={id:$("#ddl-edit-load-section").val()},u={id:$("#ddl-edit-load-track").val(),name:$("#ddl-edit-load-track").find(":selected").text()},m={id:$("#ddl-edit-load-strand").val(),name:$("#ddl-edit-load-strand").find(":selected").text()},h={id:$("#ddl-edit-load-program").val(),name:$("#ddl-edit-load-program").find(":selected").text()};if(!d.id||0==d.id){d.name=$("#txt-edit-load-curriculum-name").val();var p=[],f=$("#msl-edit-load-curricular-classifications").val();f.forEach(function(e){p.push(e)}),d.curricular_classification_ids=p}var v={curriculum:d,level_id:r.id,term_id:l.id,track_id:""!=u.id?u.id:null,strand_id:""!=m.id?m.id:null,program_id:""!=h.id?h.id:null},g={school_id:a.id,term_category_id:n.id},b={name:$("#ddl-edit-load-academic-calendar-year").find("option:selected").text().replace("A.Y.","S.Y."),school_id:a.id,academic_calendar_year_id:i.id,current:$("#ddl-edit-load-academic-calendar-year").data("current")},w={school_id:a.id,curriculum_step:v};o.id&&0!=o.id?o.category={id:$("#ddl-edit-load-subject").find(":selected").data("category"),name:$("#ddl-edit-load-subject").find(":selected").data("category-name")}:(o.code=$("#txt-edit-load-subject-code").val(),o.title=$("#txt-edit-load-subject-title").val(),o.category={id:$("#ddl-edit-load-subject-subject-category").val(),name:$("#ddl-edit-load-subject-subject-category").find(":selected").text()}),c.id&&0!=c.id||("core curriculum"==o.category.name.toLowerCase()?c.name=$("#ddl-edit-load-level").find("option:selected").text()+"-"+$("#txt-edit-load-section").val():"applied track"==o.category.name.toLowerCase()&&u&&u.name&&""!=u.name?c.name=u.name+" "+$("#ddl-edit-load-level").find("option:selected").data("sequence")+"-"+$("#txt-edit-load-section").val():"specialized"==o.category.name.toLowerCase()&&m&&m.name&&""!=m.name?c.name=m.name+" "+$("#ddl-edit-load-level").find("option:selected").data("sequence")+"-"+$("#txt-edit-load-section").val():h&&h.name&&""!=h.name&&(c.name=h.name+" "+$("#ddl-edit-load-level").find("option:selected").data("sequence")+"-"+$("#txt-edit-load-section").val()),c.school_level={school_curricular_classification:{school_id:a.id,curricular_classification_id:s.id},level_id:r.id},c.section=$("#txt-edit-load-section").val());var _={curriculum_step:v,subject:o},y={school_curriculum_step:w,curriculum_step_subject:_},k={id:t,block:c,school_curriculum_step_subject:y,school_calendar_year:b,school_calendar_term:{school_calendar_year:b,school_term:{school_term_category:g,term:l}},schedules:e,path:window.location.pathname};load.update(k,function(e){return $("#modal-edit-load").modal("hide"),$("body").removeClass("modal-open"),$(".modal-backdrop").remove(),"ERROR"==e.status?("SCHOOL_CODE_EXISTS"==e.code&&($("#modal-edit-load").find(".wizard-container").show(),$("#modal-edit-load").find(".complete-container").hide(),$("#modal-edit-load").find(".incomplete-container").hide(),$("#modal-edit-load").find(".cancel-container").hide(),$("#wizard-edit-load").bootstrapWizard("first"),$("#modal-edit-load .new-school").show(),$("#modal-edit-load .new-school").find(".alert-danger").text(e.error).show()),!1):($("#modal-edit-load .saving-container").hide(),$("#modal-edit-load .complete-container").show(),void(e.page_content&&e.ribbon_content?"/loads"==e.path?loads.reloadPageContent(e,"Load successfully edited!",function(){setTimeout(function(){$(".page-success").slideUp()},5e3)}):"/classes"==e.path&&classes.reloadPageContent(e,"Class successfully edited!",function(){setTimeout(function(){$(".page-success").slideUp()},5e3)}):(window.location.href=e.path+"#load"+e.load.id,window.location.reload())))})}),add_load_changed=!1,$(".add-load").unbind("click").on("click",function(){$("#modal-add-load").find(".wizard-container").show(),$("#modal-add-load").find(".complete-container").hide(),$("#modal-add-load").find(".saving-container").hide(),$("#modal-add-load").find(".error-container").hide(),$("#modal-add-load").find(".overlimit-container").hide(),$("#modal-add-load").find(".incomplete-container").hide(),$("#modal-add-load").find(".cancel-container").hide(),$("#modal-add-load").find(".wizard-container").find(".select-single").select2("val",""),$("#modal-add-load").find(".wizard-container").find(".select-multiple").select2("val",""),$("#wizard-add-load").bootstrapWizard("first");var e=1;$("#wizard-add-load").find(".form-wizard").find("li").each(function(){$(this).removeClass("complete"),$(this).find(".step").html(e),e++}),$("#modal-add-load").find(".form-group").removeClass("has-error"),$("#modal-add-load").find(".form-group").removeClass("has-success"),$add_load_validator.resetForm(),$("#txt-add-load-lite-name").val(""),$("#modal-add-load .from-schedule").timepicker("setTime",util.getCurrentEstimatedTime()).on("changeTime.timepicker",function(){$("#modal-add-load .schedule tbody tr").find("select.day-schedule").valid(),$("#modal-add-load .schedule tbody tr").find(".from-schedule").valid(),$("#modal-add-load .schedule tbody tr").find(".to-schedule").valid()}),$("#modal-add-load .to-schedule").timepicker("setTime",util.getCurrentEstimatedTime(1,0,0)).on("changeTime.timepicker",function(){$("#modal-add-load .schedule tbody tr").find("select.day-schedule").valid(),$("#modal-add-load .schedule tbody tr").find(".from-schedule").valid(),$("#modal-add-load .schedule tbody tr").find(".to-schedule").valid()}),$("#modal-add-load").find(".wizard-container").find("select.form-control").each(function(){var e=$(this).find("option[data-current=1]").prop("value");e||$(this).val("")}),$(".schedule-delete").each(function(){$(this).click()}),$(".new-section").hide(),$(".old-section").show(),$(".senior-high").hide(),$(".college").hide(),$("#txt-add-load-section").rules("remove","required"),$("#ddl-add-load-section").rules("add","required"),$(".new-section").find(".wizard-container").find(".form-group").removeClass("has-error"),$(".new-section").find(".wizard-container").find(".form-group").removeClass("has-success"),$("#ddl-add-load-section").find("option").show(),$("#ddl-add-load-strand").find("option").show(),$("#modal-add-load .form-control, #modal-add-load .select-single").on("change",function(){add_load_changed=!0}),$("#modal-add-load .schedule .btn").on("click",function(){add_load_changed=!0}),add_load_changed=!1,$("#ddl-add-load-subject").bind()}),$("#wizard-add-load").bootstrapWizard({tabClass:"form-wizard",onNext:function(e,t,a){var d=$("#frm-add-load").valid();if(!d)return $("#wizard-add-load").find(".form-wizard").children("li").eq(a-1).removeClass("complete"),$("#wizard-add-load").find(".form-wizard").children("li").eq(a-1).find(".step").html(a),$add_load_validator.focusInvalid(),!1;$("#wizard-add-load").find(".form-wizard").children("li").eq(a-1).addClass("complete"),$("#wizard-add-load").find(".form-wizard").children("li").eq(a-1).find(".step").html('<i class="fa fa-check"></i>');var o=$("#wizard-add-load").find(".complete").length;3==o?($("#modal-add-load").find(".wizard-container").hide(),$("#modal-add-load").find(".complete-container").show()):3==a&&($("#modal-add-load").find(".wizard-container").hide(),$("#modal-add-load").find(".incomplete-container").show())}}),$("#modal-add-load .wizard-back").unbind("click").on("click",function(){$("#modal-add-load .wizard-container").show(),$("#modal-add-load .modal-footer").show(),$("#modal-add-load .complete-container").hide(),$("#modal-add-load .incomplete-container").hide(),$("#modal-add-load .overlimit-container").hide(),$("#modal-add-load .cancel-container").hide()}),$("#modal-add-load .cancel").unbind("click").on("click",function(){add_load_changed?($("#modal-add-load .cancel-container").show(),$("#modal-add-load .overlimit-container").hide(),$("#modal-add-load .wizard-container").hide(),$("#modal-add-load .modal-footer").hide()):$("#modal-add-load").modal("hide")}),$add_load_lite_validator=$("#frm-add-load-lite").validate({rules:{name:{required:!0}},messages:{name:"Please enter a name."},highlight:function(e){$(e).closest(".form-group").removeClass("has-success").addClass("has-error")},unhighlight:function(e){$(e).closest(".form-group").removeClass("has-error").addClass("has-success")},errorElement:"span",errorClass:"help-block",errorPlacement:function(e,t){t.parent(".input-group").length?e.insertAfter(t.parent()):e.insertAfter(t)}}),$("#frm-add-load-lite").unbind("submit").on("submit",function(e){e.preventDefault();var t=$("#frm-add-load-lite").valid();if(!t)return $add_load_lite_validator.focusInvalid(),!1;var a=$("#txt-add-load-lite-name").val(),d={name:a,path:window.location.pathname};$("#btn-add-load-lite").attr("disabled","disabled").find("i").removeClass("fa-save").addClass("fa-cog").addClass("fa-spin"),load.store(d,function(e){return $("#btn-add-load-lite").removeAttr("disabled").find("i").removeClass("fa-cog").removeClass("fa-spin").addClass("fa-save"),"ERROR"==e.status?($("#modal-add-load-lite .alert-danger").show().html('<i class="fa fa-times"></i> '+e.error),!1):"OVERLIMIT"==e.status?($("#modal-add-load-lite .alert-danger").html('<i class="fa fa-times"></i> '+e.error+' <a href="/'+e.role.name.toLowerCase()+'Pricing" target="_blank" class="btn btn-xs btn-success">Upgrade</a>&nbsp;<button type="submit" class="btn btn-xs btn-primary">Try Again</button>').show(),!1):($("#modal-add-load-lite").modal("hide"),$("body").removeClass("modal-open"),$(".modal-backdrop").remove(),void(e.page_content&&e.ribbon_content?($("#content").empty().html(e.page_content),$("#ribbon").empty().html(e.ribbon_content),setTimeout(function(){$(".page-success").slideDown("slow").find(".alert-success").html('<i class="fa fa-check"></i> Load/Class successfully added!')},1e3),setTimeout(function(){$(".page-success").slideUp()},5e3),tab.autoCollapse(),tab.init(),"/teacherWhiteboard"==window.location.pathname?teacherWhiteboard.bindTeacherWhiteboard():"/loads"==window.location.pathname?(loads.bindLoads(),window.history.pushState("string","Serapina",e.path+"#load"+e.load.id)):"/timetable"==window.location.pathname?timetable.bindTimetable():"/attendance"==window.location.pathname?(attendance.bindAttendances(),window.history.pushState("string","Serapina",e.path+"#load"+e.load.id)):"/grades"==window.location.pathname?(grades.bindGrades(),window.history.pushState("string","Serapina",e.path+"#load"+e.load.id)):"/tests"==window.location.pathname?(tests.bindTests(),window.history.pushState("string","Serapina",e.path+"#load"+e.load.id)):"/studentWhiteboard"==window.location.pathname?studentWhiteboard.bindStudentWhiteboard():"/notes"==window.location.pathname&&notes.bindNotes(),app.bindApp()):(window.location.href=e.path+"#load"+e.load.id,window.location.reload())))})}),$add_load_validator=$("#frm-add-load").validate({rules:{curriculum_id:{required:!0},subject_id:{required:!0},school_calendar_year:{required:!0},school_calendar_term:{required:!0},student_level:{required:!0},schedule_day_1:{required:!0,add_unique_schedule:!0},schedule_from_1:{required:!0,add_unique_schedule:!0,add_range:!0},schedule_to_1:{required:!0,add_unique_schedule:!0,add_range:!0}},messages:{curriculum_id:"Please select a curriculum.",subject_id:"Please select a subject.",school_calendar_year:"Please select a school year.",school_calendar_term:"Please select a school term.",student_level:"Please select a student level."},highlight:function(e){$(e).closest(".form-group").removeClass("has-success").addClass("has-error")},unhighlight:function(e){$(e).closest(".form-group").removeClass("has-error").addClass("has-success")},errorElement:"span",errorClass:"help-block",errorPlacement:function(e,t){t.parent(".input-group").length?e.insertAfter(t.parent()):e.insertAfter(t)}}),$.validator.addMethod("add_unique_schedule",function(e,t){var a=!0,d=$(t).attr("data-id"),o=$("#modal-add-load .schedule tbody tr[data-id="+d+"]").find("select.day-schedule").val(),i=util.getTime($("#modal-add-load .schedule tbody tr[data-id="+d+"]").find(".from-schedule")),n=util.getTime($("#modal-add-load .schedule tbody tr[data-id="+d+"]").find(".to-schedule")),l=[];return $("#modal-add-load .schedule").find("tbody tr").each(function(){var e=$(this).find("select.day-schedule").val(),t=util.getTime($(this).find(".from-schedule")),a=util.getTime($(this).find(".to-schedule"));e&&e.forEach(function(e){l.push({day_of_week:e,start_time:t,end_time:a})})}),o?(o.forEach(function(e){var t=0;l.forEach(function(a){e==a.day_of_week&&(i>=a.start_time&&i<a.end_time||n>a.start_time&&n<=a.end_time)&&t++}),t>1&&(a=!1)}),a):!0},"Conflicting schedules are not allowed."),$.validator.addMethod("add_range",function(e,t){var a=$(t).attr("data-id"),d=!0;return $("#modal-add-load .schedule").find("tbody tr[data-id="+a+"]").each(function(){var e=util.getTime($(this).find(".from-schedule")),t=util.getTime($(this).find(".to-schedule"));e>=t&&(d=!1)}),d},"Please input a valid range of time."),$("#modal-add-load").on("shown.bs.modal",function(){$("#ddl-add-load-subject").trigger("change"),$("#ddl-add-load-subject").unbind("change").on("change",function(){0==$(this).val()?$(".new-subject").show():$(".new-subject").hide()}),$("#ddl-add-load-curriculum").trigger("change"),$("#ddl-add-load-curriculum").unbind("change").on("change",function(){0==$(this).val()?$(".new-curriculum").show():$(".new-curriculum").hide();var e=$(this).val();d(e,null,"add",null),$("#msl-add-load-curricular-classifications").unbind("change").on("change",function(){var e=$(this).val();d(null,e,"add",null)})})}),$("#modal-add-load .from-schedule").timepicker().on("changeTime.timepicker",function(){$("#modal-add-load .schedule tbody tr").find("select.day-schedule").valid(),$("#modal-add-load .schedule tbody tr").find(".from-schedule").valid(),$("#modal-add-load .schedule tbody tr").find(".to-schedule").valid()}),$("#modal-add-load .to-schedule").timepicker().on("changeTime.timepicker",function(){$("#modal-add-load .schedule tbody tr").find("select.day-schedule").valid(),$("#modal-add-load .schedule tbody tr").find(".from-schedule").valid(),$("#modal-add-load .schedule tbody tr").find(".to-schedule").valid()}),$("#lnk-add-load-add-schedule").unbind("click").on("click",function(){var e=$("#modal-add-load .schedule").find("tbody tr")[0].innerHTML;$("#modal-add-load .schedule").find("tbody").append("<tr>"+e.replace("<center></center>",'<center><a class="btn btn-sm btn-danger schedule-delete"><i class="fa fa-trash-o"></i></a></center>')+"</tr>"),$("#modal-add-load tbody tr:last-child select.day-schedule").parent().find(".help-block").remove(),$("#modal-add-load tbody tr:last-child .from-schedule").parent().parent().find(".help-block").remove(),$("#modal-add-load tbody tr:last-child .to-schedule").parent().parent().find(".help-block").remove(),$("#modal-add-load tbody tr:last-child select.day-schedule").parent().removeClass("has-error").removeClass("has-success"),$("#modal-add-load tbody tr:last-child .from-schedule").parent().parent().removeClass("has-error").removeClass("has-success"),$("#modal-add-load tbody tr:last-child .to-schedule").parent().parent().removeClass("has-error").removeClass("has-success"),$("#modal-add-load .schedule").find("tbody tr:last-child .from-schedule").timepicker("setTime",util.getCurrentEstimatedTime()).on("changeTime.timepicker",function(){$("#modal-add-load .schedule tbody tr").find("select.day-schedule").valid(),$("#modal-add-load .schedule tbody tr").find(".from-schedule").valid(),$("#modal-add-load .schedule tbody tr").find(".to-schedule").valid()}),$("#modal-add-load .schedule").find("tbody tr:last-child .to-schedule").timepicker("setTime",util.getCurrentEstimatedTime(1,0,0)).on("changeTime.timepicker",function(){
$("#modal-add-load .schedule tbody tr").find("select.day-schedule").valid(),$("#modal-add-load .schedule tbody tr").find(".from-schedule").valid(),$("#modal-add-load .schedule tbody tr").find(".to-schedule").valid()}),$("#modal-add-load .schedule").find("tbody tr:last-child .schedule-delete").on("click",function(){$(this).parent().parent().parent().remove(),$("#modal-add-load select.day-schedule").valid(),$("#modal-add-load .from-schedule").valid(),$("#modal-add-load .to-schedule").valid()}),$("#modal-add-load tbody tr:last-child .select2-container").remove(),$("#modal-add-load tbody tr:last-child select.day-schedule").val("").select2().on("change",function(e){$("#modal-add-load select.day-schedule").valid(),$("#modal-add-load .from-schedule").valid(),$("#modal-add-load .to-schedule").valid()}),$("#modal-add-load tbody tr:last-child select.day-schedule").prop("name","schedule_day_"+$(".schedule").find("tbody tr").length),$("#modal-add-load tbody tr:last-child .from-schedule").prop("name","schedule_from_"+$(".schedule").find("tbody tr").length),$("#modal-add-load tbody tr:last-child .to-schedule").prop("name","schedule_to_"+$(".schedule").find("tbody tr").length),$("#modal-add-load tbody tr:last-child").attr("data-id",$(".schedule").find("tbody tr").length),$("#modal-add-load tbody tr:last-child select.day-schedule").attr("data-id",$(".schedule").find("tbody tr").length),$("#modal-add-load tbody tr:last-child .from-schedule").attr("data-id",$(".schedule").find("tbody tr").length),$("#modal-add-load tbody tr:last-child .to-schedule").attr("data-id",$(".schedule").find("tbody tr").length),$("#frm-add-load").validate(),$("#modal-add-load tbody tr:last-child select.day-schedule").rules("add","required"),$("#modal-add-load tbody tr:last-child .from-schedule").rules("add","required"),$("#modal-add-load tbody tr:last-child .to-schedule").rules("add","required"),$("#modal-add-load tbody tr:last-child select.day-schedule").rules("add","add_unique_schedule"),$("#modal-add-load tbody tr:last-child .from-schedule").rules("add","add_unique_schedule"),$("#modal-add-load tbody tr:last-child .to-schedule").rules("add","add_unique_schedule"),$("#modal-add-load tbody tr:last-child .from-schedule").rules("add","add_range"),$("#modal-add-load tbody tr:last-child .to-schedule").rules("add","add_range")}),$("#ddl-add-load-level").unbind("change").on("change",function(){var t=$(this).val(),a=$("#hdn-school-id").val();e(a,t,"add",null),o("add")}),$("#ddl-add-load-section").unbind("change").on("change",function(){var e=$(this).find(":selected").data("level");0==$(this).val()?($("#modal-add-load .new-section").show(),$("#txt-add-load-section").rules("add","required"),$("#modal-add-load .new-section").find(".wizard-container").find(".form-group").removeClass("has-error"),$("#modal-add-load .new-section").find(".wizard-container").find(".form-group").removeClass("has-success")):($("#modal-add-load .new-section").hide(),$("#txt-add-load-section").rules("remove","required"),$("#modal-add-load .new-section").find(".wizard-container").find(".form-group").removeClass("has-error"),$("#modal-add-load .new-section").find(".wizard-container").find(".form-group").removeClass("has-success"),$("#ddl-add-load-level").val(e))}),$("#ddl-add-load-track").unbind("change").on("change",function(){var e=$(this).val();a(e,"add",null)}),$("#ddl-add-load-strand").unbind("change").on("change",function(){var e=$(this).find(":selected").data("track");$("#ddl-add-load-track").val(e)}),$("#modal-add-load .wizard-save").unbind("click").on("click",function(){$("#modal-add-load .overlimit-container").hide(),$("#modal-add-load .complete-container").hide(),$("#modal-add-load .saving-container").show();var e=[];new Date;$("#modal-add-load .schedule").find("tbody tr").each(function(){var t=$(this).find("select.day-schedule").val(),a=util.getTime($(this).find(".from-schedule")),d=util.getTime($(this).find(".to-schedule"));t.forEach(function(t){e.push({day_of_week:t,start_time:a,end_time:d})})});var t={id:$("#hdn-school-id").val()},a={id:$("#ddl-add-load-curriculum").val()},d={id:$("#ddl-add-load-subject").val()},o={id:$("#ddl-add-load-academic-calendar-year").val()},i={id:$("#ddl-add-load-term").find(":selected").data("term-category")},n={id:$("#ddl-add-load-term").val()},l={id:$("#ddl-add-load-level").find(":selected").data("curricular-classification-id")},s={id:$("#ddl-add-load-level").val()},r={id:$("#ddl-add-load-section").val()},c={id:$("#ddl-add-load-track").val(),name:$("#ddl-add-load-track").find(":selected").text()},u={id:$("#ddl-add-load-strand").val(),name:$("#ddl-add-load-strand").find(":selected").text()},m={id:$("#ddl-add-load-program").val(),name:$("#ddl-add-load-program").find(":selected").text()};if(!a.id||0==a.id){a.name=$("#txt-add-load-curriculum-name").val();var h=[],p=$("#msl-add-load-curricular-classifications").val();p.forEach(function(e){h.push(e)}),a.curricular_classification_ids=h}var f={curriculum:a,level_id:s.id,term_id:n.id,track_id:""!=c.id?c.id:null,strand_id:""!=u.id?u.id:null,program_id:""!=m.id?m.id:null},v={school_id:t.id,term_category_id:i.id},g={name:$("#ddl-add-load-academic-calendar-year").find("option:selected").text().replace("A.Y.","S.Y."),school_id:t.id,academic_calendar_year_id:o.id,current:$("#ddl-add-load-academic-calendar-year").data("current")},b={school_id:t.id,curriculum_step:f};d.id&&0!=d.id?d.category={id:$("#ddl-add-load-subject").find(":selected").data("category"),name:$("#ddl-add-load-subject").find(":selected").data("category-name")}:(d.code=$("#txt-add-load-subject-code").val(),d.title=$("#txt-add-load-subject-title").val(),d.category={id:$("#ddl-add-load-subject-subject-category").val(),name:$("#ddl-add-load-subject-subject-category").find(":selected").text()}),r.id&&0!=r.id||("core curriculum"==d.category.name.toLowerCase()?r.name=$("#ddl-add-load-level").find("option:selected").text()+"-"+$("#txt-add-load-section").val():"applied track"==d.category.name.toLowerCase()?r.name=c.name+" "+$("#ddl-add-load-level").find("option:selected").data("sequence")+"-"+$("#txt-add-load-section").val():"specialized"==d.category.name.toLowerCase()?r.name=u.name+" "+$("#ddl-add-load-level").find("option:selected").data("sequence")+"-"+$("#txt-add-load-section").val():m&&m.name&&""!=m.name&&(r.name=m.name+" "+$("#ddl-edit-load-level").find("option:selected").data("sequence")+"-"+$("#txt-edit-load-section").val()),r.school_level={school_curricular_classification:{school_id:t.id,curricular_classification_id:l.id},level_id:s.id},r.section=$("#txt-add-load-section").val());var w={curriculum_step:f,subject:d},_={school_curriculum_step:b,curriculum_step_subject:w},y={block:r,school_curriculum_step_subject:_,school_calendar_year:g,school_calendar_term:{school_calendar_year:g,school_term:{school_term_category:v,term:n}},schedules:e,path:window.location.pathname};load.store(y,function(e){return"ERROR"==e.status?("SCHOOL_CODE_EXISTS"==e.code&&($("#modal-add-load").find(".wizard-container").show(),$("#modal-add-load").find(".complete-container").hide(),$("#modal-add-load").find(".incomplete-container").hide(),$("#modal-add-load").find(".cancel-container").hide(),$("#wizard-add-load").bootstrapWizard("first"),$("#modal-add-load .new-school").show(),$("#modal-add-load .saving-container").hide(),$("#modal-add-load .error-container").show().find(".error-message").html(e.error)),!1):"OVERLIMIT"==e.status?($("#modal-add-load").find(".saving-container").hide(),$("#modal-add-load").find(".wizard-container").hide(),$("#modal-add-load").find(".complete-container").hide(),$("#modal-add-load").find(".incomplete-container").hide(),$("#modal-add-load").find(".error-container").hide(),$("#modal-add-load").find(".cancel-container").hide(),$("#modal-add-load").find(".overlimit-container").show(),$("#modal-add-load").find(".overlimit-container .error-message .plan").text(e.plan.name),!1):($("#modal-add-load").modal("hide"),$("body").removeClass("modal-open"),$(".modal-backdrop").remove(),$("#modal-add-load .saving-container").hide(),$("#modal-add-load .complete-container").show(),void(e.page_content&&e.ribbon_content?($("#content").empty().html(e.page_content),$("#ribbon").empty().html(e.ribbon_content),setTimeout(function(){$(".page-success").slideDown("slow").find(".alert-success").html('<i class="fa fa-check"></i> Load/Class successfully added!')},1e3),setTimeout(function(){$(".page-success").slideUp()},5e3),tab.autoCollapse(),tab.init(),"/teacherWhiteboard"==window.location.pathname?teacherWhiteboard.bindTeacherWhiteboard():"/loads"==window.location.pathname?(loads.bindLoads(),window.history.pushState("string","Serapina",e.path+"#load"+e.load.id)):"/timetable"==window.location.pathname?timetable.bindTimetable():"/attendance"==window.location.pathname?(attendance.bindAttendances(),window.history.pushState("string","Serapina",e.path+"#load"+e.load.id)):"/grades"==window.location.pathname?(grades.bindGrades(),window.history.pushState("string","Serapina",e.path+"#load"+e.load.id)):"/tests"==window.location.pathname?(tests.bindTests(),window.history.pushState("string","Serapina",e.path+"#load"+e.load.id)):"/studentWhiteboard"==window.location.pathname?studentWhiteboard.bindStudentWhiteboard():"/notes"==window.location.pathname&&notes.bindNotes(),app.bindApp()):(window.location.href=e.path+"#load"+e.load.id,window.location.reload())))})}),$("#modal-add-students .invite-students").unbind("click").on("click",function(){add_method="INVITE",$("#modal-add-students .options-container").hide(),$("#modal-add-students .copy-container").hide(),$("#modal-add-students .invite-container").show(),$("#modal-add-students .manual-container").hide(),$("#modal-add-students .import-container").hide(),$("#modal-add-students .modal-footer").show(),$("#ddl-invite-student-by").val("account"),$(".ms-sel-ctn > input").focus()}),$("#modal-add-students .import-students").unbind("click").on("click",function(){add_method="IMPORT",$("#modal-add-students .options-container").hide(),$("#modal-add-students .copy-container").hide(),$("#modal-add-students .invite-container").hide(),$("#modal-add-students .manual-container").hide(),$("#modal-add-students .import-container").show(),$("#modal-add-students .modal-footer").hide(),$("#wizard-import-students").bootstrapWizard("first"),$("#lnk-upload-import-students-csv").show(),$("#wizard-import-students .upload-status").hide();var e=1;$("#wizard-import-students").find(".form-wizard").find("li").each(function(){$(this).removeClass("complete"),$(this).find(".step").html(e),e++}),i()}),$("#tbl-import-students-csv-columns").length>0&&!$("#tbl-import-students-csv-columns").hasClass("initialized")&&($("#tbl-import-students-csv-columns").not(".initialized").addClass("initialized").dataTable({sDom:"r<'dt-wrapper't><'dt-row dt-bottom-row'<'row'<'col-sm-12 text-right'p>>",bPaginate:!1,oTableTools:{aButtons:[]}}).rowReordering({fnUpdateCallback:function(e){i()}}),$("#tbl-import-students-csv-columns").find(".form-group input[type=checkbox]").unbind("click").on("click",function(){i()})),$("#wizard-import-students").bootstrapWizard({tabClass:"form-wizard",onNext:function(e,t,a){var d=$("#frm-import-students").valid();if(!d)return $("#wizard-import-students").find(".form-wizard").children("li").eq(a-1).removeClass("complete"),$("#wizard-import-students").find(".form-wizard").children("li").eq(a-1).find(".step").html(a),!1;$("#wizard-import-students").find(".form-wizard").children("li").eq(a-1).addClass("complete"),$("#wizard-import-students").find(".form-wizard").children("li").eq(a-1).find(".step").html('<i class="fa fa-check"></i>');var o=[],i=0;$("#tbl-import-students-csv-preview tbody tr").each(function(){var e=["A","B","C","D","E","F","G","H"],t=0;$(this).find("td").each(function(){if(t>0){var a={column:e[t-1],row:i+1,value:$(this).text()};o.push(a)}t++}),i++}),1==a&&($("#lnk-download-import-students-csv-template").html('<i class="fa fa-cog fa-spin"></i> Generating...').attr("disabled","disabled"),util.generateCSV("import students template",o,function(e){$("#lnk-download-import-students-csv-template").html('<i class="fa fa-download"></i> Download').removeAttr("disabled"),"OK"==e.status&&$("#lnk-download-import-students-csv-template").attr("href",e.path)}),$("#lnk-upload-import-students-csv").unbind("click").on("click",function(){$("#wizard-import-students .file-import").click()}),$("#wizard-import-students .file-import").val(""),$("#wizard-import-students .file-import").unbind("change").on("change",function(e){$("#lnk-upload-import-students-csv").hide();var t,a=e.target;a.files&&a.files[0]&&(t=new FileReader,t.onload=function(e){$("#wizard-import-students .file-import").val().substring($("#wizard-import-students .file-import").val().lastIndexOf("\\")+1);$("#frm-import-students").submit()},t.readAsDataURL(a.files[0]))}))}}),$("#frm-import-students").unbind("submit").on("submit",function(e){e.preventDefault();var t=document.getElementById("wizard-import-students").getElementsByClassName("file-import")[0];if(t.files&&t.files[0]){var a=$("meta[name='csrf-token']").attr("content"),d=$("#hdn-add-students-load-id").val(),o=new XMLHttpRequest,i=new FormData;i.append("file-upload",t.files[0]),i.append("path",window.location.pathname),o.onreadystatechange=function(){if(4==o.readyState)if(200==o.status)try{var e=JSON.parse(o.responseText);"OK"==e.status?($("#wizard-import-students .upload-status .progress").show(),$("#wizard-import-students .upload-status .progress-bar").css("width","100%"),$("#wizard-import-students .upload-status span").html("Uploaded succesfully! 100%"),uploadProfileStatus="FILE_UPLOADED",e.tab_content?"/loads"==window.location.pathname?loads.reloadTabContent(e,"Students successfully imported!",function(){setTimeout(function(){$(".page-success").slideUp()},5e3)}):"/attendance"==window.location.pathname?attendance.reloadTabContent(e,"Students successfully imported!",function(){setTimeout(function(){$(".page-success").slideUp()},5e3)}):"/grades"==window.location.pathname&&grades.reloadTabContent(e,"Students successfully imported!",function(){setTimeout(function(){$(".page-success").slideUp()},5e3)}):window.location.reload()):(uploadProfileStatus="FILE_UPLOAD_ERROR",$("#lnk-upload-import-students-csv").show(),$("#wizard-import-students .file-import").val(""),$("#wizard-import-students .upload-status .progress").hide(),e&&e.error?$("#wizard-import-students .upload-status span").html(e.error):$("#wizard-import-students .upload-status span").html(o.responseText))}catch(t){uploadProfileStatus="FILE_UPLOAD_ERROR",$("#lnk-upload-import-students-csv").show(),$("#wizard-import-students .file-import").val(""),$("#wizard-import-students .upload-status .progress").hide(),$("#wizard-import-students .upload-status span").html(o.responseText)}else console.log(o.responseText)},o.upload.onloadstart=function(){$("#wizard-import-students .upload-status").show(),$("#wizard-import-students .upload-status span").html("Uploaded started...")},o.upload.onprogress=function(e){$("#wizard-import-students .upload-status .progress").show(),$("#wizard-import-students .upload-status .progress-bar").css("width",Math.round(e.loaded/e.total*100)+"%"),$("#wizard-import-students .upload-status span").html("Upload Progress "+Math.round(e.loaded/e.total*100)+"%")},o.upload.onerror=function(e){$("#lnk-upload-import-students-csv").show(),$("#wizard-import-students .file-import").val(""),$("#wizard-import-students .upload-status span").html("Failed to upload to server: "+e)},o.upload.onabort=function(e){$("#lnk-upload-import-students-csv").show(),$("#wizard-import-students .file-import").val(""),$("#wizard-import-students .upload-status span").html("XMLHttpRequest aborted: "+e)},o.open("POST","/loads/"+d+"/ajaxImportStudents"),o.setRequestHeader("X-CSRF-TOKEN",a),o.send(i)}}),$("#modal-add-students .manual-add-students").unbind("click").on("click",function(){add_method="MANUAL",$("#modal-add-students .options-container").hide(),$("#modal-add-students .copy-container").hide(),$("#modal-add-students .invite-container").hide(),$("#modal-add-students .manual-container").show(),$("#modal-add-students .import-container").hide(),$("#modal-add-students .modal-footer").show();var e=$("#modal-add-students .manual-container .students.male tbody > tr");if(e.length>0)for(var t=0;t<e.length;t++)t>0&&$(e[t]).remove();if(e=$("#modal-add-students .manual-container .students.female tbody > tr"),e.length>0)for(var t=0;t<e.length;t++)t>0&&$(e[t]).remove()}),$("#modal-add-students .copy-students").unbind("click").on("click",function(){add_method="COPY",$("#modal-add-students .options-container").hide(),$("#modal-add-students .manual-container").hide(),$("#modal-add-students .import-container").hide(),$("#modal-add-students .invite-container").hide(),$("#modal-add-students .copy-container").show(),$("#modal-add-students .modal-footer").show();var e=$("#hdn-add-students-load-id").val();load_obj={id:e,no_account:!0},load.showRecommendedStudents(load_obj,function(e){"OK"==e.status&&($("#modal-add-students .copy-container .students tbody").empty(),e.possible_students.length>0?($("#modal-add-students .copy-container .alert-info").show(),$("#modal-add-students .copy-container .alert-danger").hide(),$("#modal-add-students .copy-container .well").show()):($("#modal-add-students .copy-container .alert-info").hide(),$("#modal-add-students .copy-container .alert-danger").html('<i class="fa fa-times"></i> You don\'t have student from other classes').show(),$("#modal-add-students .copy-container .well").hide()),e.possible_students.forEach(function(e){$("#modal-add-students .copy-container .students tbody").append('<tr><td><label class="checkbox "><input data-id="'+e.person.id+'" class="student-select" name="checkbox-inline" type="checkbox"><i></i></label></td><td>'+e.person.last_name.toUpperCase()+", "+e.person.first_name+(e.person.middle_name&&""!=e.person.middle_name?" "+e.person.middle_name[0]+".":"")+"</td><td>"+util.capitalize(e.person.gender)+"</td></tr>"),$("#modal-add-students .copy-container .students tbody tr:last-child .student-select").on("change",function(){add_student_changed=!0}),$("#modal-add-students .copy-container .students tbody tr:last-child .student-select").on("click",function(){var e=!0;$(".student-select").each(function(){0==$(this).prop("checked")&&(e=!1)}),e?$(".student-select-all").prop("checked",!0):$(".student-select-all").prop("checked",!1)})}))})}),$("#modal-add-students .back-to-options").unbind("click").on("click",function(){$("#modal-add-students .options-container").show(),$("#modal-add-students .manual-container").hide(),$("#modal-add-students .import-container").hide(),$("#modal-add-students .copy-container").hide(),$("#modal-add-students .invite-container").hide(),$("#modal-add-students .modal-footer").hide()}),add_student_changed=!1,$(".add-students").unbind("click").on("click",function(){$("#modal-add-students").find("alert-danger").hide(),$("#modal-add-students").find(".wizard-container").show(),$("#modal-add-students").find(".options-container").show(),$("#modal-add-students").find(".manual-container").hide(),$("#modal-add-students").find(".import-container").hide(),$("#modal-add-students").find(".copy-container").hide(),$("#modal-add-students").find(".invite-container").hide(),$("#modal-add-students").find(".complete-container").hide(),$("#modal-add-students").find(".incomplete-container").hide(),$("#modal-add-students").find(".cancel-container").hide(),$("#tbl-more-columns input[type=checkbox]").each(function(){$(this).prop("checked")&&$(this).trigger("click")}),$("#modal-add-students").find(".wizard-container").find(".form-control").val(""),$("#ddl-invite-student-by").val("account"),$(".invite-by-account").show(),$(".invite-by-email").hide(),$("#txt-student-emails").tagsinput("removeAll"),account_suggests.clear(),$("#modal-add-students").find(".wizard-container").find(".form-group").removeClass("has-error"),$("#modal-add-students").find(".wizard-container").find(".form-group").removeClass("has-success"),$manual_add_student_validator.resetForm(),$invite_student_validator.resetForm(),$("#modal-add-students .modal-footer").hide(),$("#hdn-add-students-load-id").val($(this).data("load-id")),$("#modal-add-students .form-control").on("change",function(){add_student_changed=!0}),add_student_changed=!1}),$(".student-select-all").unbind("click").on("click",function(){$(this).prop("checked")?$("#modal-add-students .copy-container .student-select").prop("checked",!0):$("#modal-add-students .copy-container .student-select").prop("checked",!1)}),n(),$("#lnk-add-students-add-male-student").unbind("click").on("click",function(){l("male")}),$("#lnk-add-students-add-female-student").unbind("click").on("click",function(){l("female")}),$("#chk-repeater-column").unbind("change").on("change",function(){$(this).prop("checked")?$(".repeater-column").show():$(".repeater-column").hide()}),$("#chk-balik-aral-column").unbind("change").on("change",function(){$(this).prop("checked")?$(".balik-aral-column").show():$(".balik-aral-column").hide()}),$("#chk-4Ps-column").unbind("change").on("change",function(){$(this).prop("checked")?$(".4Ps-column").show():$(".4Ps-column").hide()}),$manual_add_student_validator=$("#frm-manual-add-students").validate({rules:{student_first_name_1:{required:{depends:function(e){return female_first_name=$(".manual-container .students.female tbody tr:first-child .first-name-student").val().trim(),female_middle_name=$(".manual-container .students.female tbody tr:first-child .middle-name-student").val().trim(),female_last_name=$(".manual-container .students.female tbody tr:first-child .last-name-student").val().trim(),male_middle_name=$(".manual-container .students.male tbody tr:first-child .middle-name-student").val().trim(),male_last_name=$(".manual-container .students.male tbody tr:first-child .last-name-student").val().trim(),female_first_name&&female_last_name?male_middle_name||male_last_name?!0:!1:!0}}},student_last_name_1:{required:{depends:function(e){return female_first_name=$(".manual-container .students.female tbody tr:first-child .first-name-student").val().trim(),female_middle_name=$(".manual-container .students.female tbody tr:first-child .middle-name-student").val().trim(),female_last_name=$(".manual-container .students.female tbody tr:first-child .last-name-student").val().trim(),male_first_name=$(".manual-container .students.male tbody tr:first-child .first-name-student").val().trim(),male_middle_name=$(".manual-container .students.male tbody tr:first-child .middle-name-student").val().trim(),female_first_name&&female_last_name?male_middle_name||male_first_name?!0:!1:!0}}},student_email_1:{email:!0},student_first_name_2:{required:{depends:function(e){return male_first_name=$(".manual-container .students.male tbody tr:first-child .first-name-student").val().trim(),male_middle_name=$(".manual-container .students.male tbody tr:first-child .middle-name-student").val().trim(),male_last_name=$(".manual-container .students.male tbody tr:first-child .last-name-student").val().trim(),female_middle_name=$(".manual-container .students.female tbody tr:first-child .middle-name-student").val().trim(),female_last_name=$(".manual-container .students.female tbody tr:first-child .last-name-student").val().trim(),male_first_name&&male_last_name?female_middle_name||female_last_name?!0:!1:!0}}},student_last_name_2:{required:{depends:function(e){return male_first_name=$(".manual-container .students.male tbody tr:first-child .first-name-student").val().trim(),male_middle_name=$(".manual-container .students.male tbody tr:first-child .middle-name-student").val().trim(),male_last_name=$(".manual-container .students.male tbody tr:first-child .last-name-student").val().trim(),female_first_name=$(".manual-container .students.female tbody tr:first-child .first-name-student").val().trim(),female_middle_name=$(".manual-container .students.female tbody tr:first-child .middle-name-student").val().trim(),male_first_name&&male_last_name?female_first_name||female_middle_name?!0:!1:!0}}},student_email_2:{email:!0}},messages:{student_first_name_1:"Please enter the first name.",student_last_name_1:"Please enter the last name.",student_email_1:{email:"Please enter a valid email."},student_first_name_2:"Please enter the first name.",student_last_name_2:"Please enter the last name.",student_email_2:{email:"Please enter a valid email."}},highlight:function(e){$(e).closest(".form-group").removeClass("has-success").addClass("has-error")},unhighlight:function(e){$(e).closest(".form-group").removeClass("has-error").addClass("has-success")},errorElement:"span",errorClass:"help-block",errorPlacement:function(e,t){t.parent(".input-group").length?e.insertAfter(t.parent()):e.insertAfter(t)}}),$("#frm-manual-add-students").unbind("submit").on("submit",function(e){e.preventDefault(),s("male"),s("female");var t=$("#frm-manual-add-students").valid();if(!t)return $manual_add_student_validator.focusInvalid(),!1;var a=$("#hdn-add-students-load-id").val(),d=[];$("#modal-add-students .manual-container .students tbody > tr").each(function(){var e=$(this).find(".first-name-student").val(),t=$(this).find(".middle-name-student").val(),a=$(this).find(".last-name-student").val(),o=$(this).find(".email-student").val(),i=$(this).data("gender"),n=$(this).find(".repeater-student").prop("checked")?1:0,l=$(this).find(".balik-aral-student").prop("checked")?1:0,s=$(this).find(".4Ps-student").prop("checked")?1:0;if(e&&a&&i){var r={first_name:e,middle_name:t,last_name:a,email:o,gender:i,repeater:n,balik_aral:l,four_Ps:s};d.push(r)}});var o={id:a,students:d,path:window.location.pathname};$("#btn-add-students").attr("disabled","disabled").find("i").removeClass("fa-save").addClass("fa-cog").addClass("fa-spin"),load.storeStudents(o,function(e){$("#btn-add-students").removeAttr("disabled").find("i").removeClass("fa-cog").removeClass("fa-spin").addClass("fa-save"),"OK"==e.status?e.tab_content?"/loads"==window.location.pathname?loads.reloadTabContent(e,"Students successfully added!",function(){setTimeout(function(){$(".page-success").slideUp()},5e3)}):"/attendance"==window.location.pathname?attendance.reloadTabContent(e,"Students successfully added!",function(){setTimeout(function(){$(".page-success").slideUp()},5e3)}):"/grades"==window.location.pathname&&grades.reloadTabContent(e,"Students successfully added!",function(){setTimeout(function(){$(".page-success").slideUp()},5e3)}):window.location.reload():"OVERLIMIT"==e.status?$("#modal-add-students").find(".alert-danger").html('<i class="fa fa-times"></i> '+e.error+' <a href="/'+e.role.name.toLowerCase()+'Pricing" target="_blank" class="btn btn-xs btn-success">Upgrade</a>&nbsp;<button type="submit" class="btn btn-xs btn-primary">Try Again</button>').show():$("#modal-add-students").find(".alert-danger").html('<i class="fa fa-times"></i> '+e.error).show()})}),$("#frm-copy-add-students").unbind("submit").on("submit",function(e){e.preventDefault();var t=$("#hdn-add-students-load-id").val(),a=[];$("#modal-add-students .copy-container .students tbody > tr").each(function(){var e=$(this).find(".student-select").data("id"),t={id:e};$(this).find(".student-select").prop("checked")&&a.push(t)});var d={id:t,students:a,path:window.location.pathname};$("#btn-add-students").attr("disabled","disabled").find("i").removeClass("fa-save").addClass("fa-cog").addClass("fa-spin"),load.storeStudents(d,function(e){$("#btn-add-students").removeAttr("disabled").find("i").removeClass("fa-cog").removeClass("fa-spin").addClass("fa-save"),"OK"==e.status?e.tab_content?"/loads"==window.location.pathname?loads.reloadTabContent(e,"Students successfully added!",function(){setTimeout(function(){$(".page-success").slideUp()},5e3)}):"/attendance"==window.location.pathname?attendance.reloadTabContent(e,"Students successfully added!",function(){setTimeout(function(){$(".page-success").slideUp()},5e3)}):"/grades"==window.location.pathname&&grades.reloadTabContent(e,"Students successfully added!",function(){setTimeout(function(){$(".page-success").slideUp()},5e3)}):window.location.reload():"OVERLIMIT"==e.status?$("#modal-add-students").find(".alert-danger").html('<i class="fa fa-times"></i> '+e.error+' <a href="/'+e.role.name.toLowerCase()+'Pricing" target="_blank" class="btn btn-xs btn-success">Upgrade</a>&nbsp;<button type="submit" class="btn btn-xs btn-primary">Try Again</button>').show():$("#modal-add-students").find(".alert-danger").html('<i class="fa fa-times"></i> '+e.error).show()})}),account_suggests=$("#pnl-student-accounts").magicSuggest({allowFreeEntries:!0,placeholder:"",method:"get",data:function(e){if(!e||""==e)return[];var t;return $.ajax({type:"get",url:"/persons/ajaxShowStudents",data:{query:e},async:!1,success:function(e){"OK"==e.status&&(t=e.suggestions)},error:function(e,t,a,d){console.log(e.responseText)}}),t},noSuggestionText:"No results found",renderer:function(e){var t;return t=e.image&&""!=e.image?e.image:"/plugins/smartadmin/img/avatars/"+e.gender+".png",'<div class="row"><div class="col-xs-3 col-sm-2 col-md-1"><img class="thumbnail-sm" src="'+t+'" /></div><div class="col-xs-9 col-sm-10 col-md-11"><div class="name"><b>'+e.value+'</b></div><div class="desc"><span>'+(e.role?e.role.name+(e.school?", "+e.school.name:""):"")+"</span></div></div></div>"}}),$(".ms-sel-ctn > input").attr("autocomplete","off"),$(".ms-sel-ctn > input").on("blur",function(){var e=jQuery.Event("keydown");e.which=13,$(this).trigger(e)}),$invite_student_validator=$("#frm-invite-students").validate({rules:{accounts:{suggests_required:!0,accounts_or_emails:!0}},messages:{accounts:{suggests_required:"Please enter accounts.",accounts_or_emails:"Please enter valid emails."}},highlight:function(e){$(e).closest(".form-group").removeClass("has-success").addClass("has-error")},unhighlight:function(e){$(e).closest(".form-group").removeClass("has-error").addClass("has-success")},errorElement:"span",errorClass:"help-block",errorPlacement:function(e,t){t.parent(".input-group").length?e.insertAfter(t.parent()):e.insertAfter(t)}}),$.validator.addMethod("suggests_required",function(e,t){return $(".ms-sel-ctn .ms-sel-item").length>0},"Please enter accounts."),$.validator.addMethod("accounts_or_emails",function(e,t){if(0==e.length)return!0;var a=[];e.split(",").forEach(function(e){isNaN(e)&&a.push(e)});var d=!0,o=[];return a.forEach(function(e){util.validateEmail(e)||(d=!1,o.push(e))}),this.val=o,d},function(){return"The following emails are not valid: <b>"+this.val.join(", ")+"</b>"}),$(account_suggests).on("selectionchange",function(e,t){add_student_changed=!0,$("#txt-student-accounts").val(this.getValue().join(",")),$("#frm-invite-students").validate().element("#txt-student-accounts");var a=$("#frm-invite-students").valid();return a?void 0:($invite_student_validator.focusInvalid(),!1)}),$("#frm-invite-students").unbind("submit").on("submit",function(e){e.preventDefault();var t=$("#frm-invite-students").valid();if(!t)return $invite_student_validator.focusInvalid(),!1;var a;a=account_suggests.getValue();var d=($("meta[name='csrf-token']").attr("content"),$("#hdn-add-students-load-id").val()),o={id:d,accounts:a};$("#btn-add-students").attr("disabled","disabled").find("i").removeClass("fa-save").addClass("fa-cog").addClass("fa-spin"),load.inviteStudents(o,function(e){$("#btn-add-students").removeAttr("disabled").find("i").removeClass("fa-cog").removeClass("fa-spin").addClass("fa-save"),"OK"==e.status?($("#modal-add-students").modal("hide"),setTimeout(function(){$(".page-success").slideDown().find(".alert-success").html('<i class="fa fa-check"></i> Invites successfully sent!')},1e3),setTimeout(function(){$(".page-success").slideUp()},5e3),"/loads"!=window.location.pathname&&window.location.reload(!0)):"OVERLIMIT"==e.status&&$("#modal-add-students").find(".alert-danger").html('<i class="fa fa-times"></i> '+e.error+' <a href="/'+e.role.name.toLowerCase()+'Pricing" target="_blank" class="btn btn-xs btn-success">Upgrade</a>&nbsp;<button type="submit" class="btn btn-xs btn-primary">Try Again</button>').show();
})}),$("#btn-add-students").unbind("click").on("click",function(){"MANUAL"==add_method?$("#frm-manual-add-students").submit():"COPY"==add_method?$("#frm-copy-add-students").submit():"INVITE"==add_method&&$("#frm-invite-students").submit()}),$("#modal-add-students .wizard-back").unbind("click").on("click",function(){$("#modal-add-students .wizard-container").show(),$("#modal-add-students .modal-footer").show(),$("#modal-add-students .complete-container").hide(),$("#modal-add-students .incomplete-container").hide(),$("#modal-add-students .cancel-container").hide()}),$("#modal-add-students .cancel").unbind("click").on("click",function(){add_student_changed?($("#modal-add-students .cancel-container").show(),$("#modal-add-students .wizard-container").hide(),$("#modal-add-students .modal-footer").hide()):$("#modal-add-students").modal("hide")}),$(".student-edit").unbind("click").on("click",function(){var e=$(this).data("enrollment-id"),t=$(this).data("person-id"),a=$(this).data("load-id");$("#modal-edit-student").find("alert-danger").hide(),$("#modal-edit-student").find(".wizard-container").find(".form-control").val(""),$("#modal-edit-student").find(".form-group").removeClass("has-error"),$("#modal-edit-student").find(".form-group").removeClass("has-success"),m.resetForm(),$("#hdn-edit-student-id").val(t),$("#hdn-edit-student-enrollment-id").val(e),$("#hdn-edit-student-load-id").val(a),enrollment.show(e,function(e){"OK"==e.status?($("#txt-edit-student-first-name").val(e.enrollment.student.person.first_name),$("#txt-edit-student-middle-name").val(e.enrollment.student.person.middle_name),$("#txt-edit-student-last-name").val(e.enrollment.student.person.last_name),$("#txt-edit-student-email").val(e.enrollment.student.person.email),$("#ddl-edit-student-gender").val(e.enrollment.student.person.gender),1==e.enrollment.repeater?$("#chk-edit-student-repeater").prop("checked",!0):$("#chk-edit-student-repeater").prop("checked",!1),1==e.enrollment.balik_aral?$("#chk-edit-student-balik-aral").prop("checked",!0):$("#chk-edit-student-balik-aral").prop("checked",!1),1==e.enrollment.four_Ps?$("#chk-edit-student-4Ps").prop("checked",!0):$("#chk-edit-student-4Ps").prop("checked",!1)):$("#modal-edit-student").find(".alert-danger").html('<i class="fa fa-pencil"></i> '+e.error).show()})});var m=$("#frm-edit-student").validate({rules:{student_first_name:{required:!0},student_last_name:{required:!0},student_email:{email:!0},student_gender:{required:!0}},messages:{student_first_name:"Please enter the first name.",student_last_name:"Please enter the last name.",student_email:{email:"Please enter a valid email."},student_gender:"Please select a gender."},highlight:function(e){$(e).closest(".form-group").removeClass("has-success").addClass("has-error")},unhighlight:function(e){$(e).closest(".form-group").removeClass("has-error").addClass("has-success")},errorElement:"span",errorClass:"help-block",errorPlacement:function(e,t){t.parent(".input-group").length?e.insertAfter(t.parent()):e.insertAfter(t)}});$("#frm-edit-student").unbind("submit").on("submit",function(e){e.preventDefault();var t=$("#frm-edit-student").valid();if(!t)return m.focusInvalid(),!1;var a=$("#hdn-edit-student-enrollment-id").val(),d=$("#hdn-edit-student-id").val(),o=$("#hdn-edit-student-load-id").val(),i=$("#txt-edit-student-first-name").val(),n=$("#txt-edit-student-middle-name").val(),l=$("#txt-edit-student-last-name").val(),s=$("#txt-edit-student-email").val(),r=$("#ddl-edit-student-gender").val(),c=$("#chk-edit-student-repeater").prop("checked")?1:0,u=$("#chk-edit-student-balik-aral").prop("checked")?1:0,h=$("#chk-edit-student-4Ps").prop("checked")?1:0,p={id:a,repeater:c,balik_aral:u,four_Ps:h,person:{id:d,first_name:i,middle_name:n,last_name:l,email:s,gender:r},load:{id:o},path:window.location.pathname};$("#btn-edit-student").attr("disabled","disabled").find("i").removeClass("fa-save").addClass("fa-cog").addClass("fa-spin"),enrollment.update(p,function(e){$("#btn-edit-student").removeAttr("disabled").find("i").removeClass("fa-cog").removeClass("fa-spin").addClass("fa-save"),"OK"==e.status?e.tab_content?loads.reloadTabContent(e,"Student successfully edited!",function(){setTimeout(function(){$(".page-success").slideUp()},5e3),window.history.pushState("string","Serapina",e.path+"#load"+e.load.id)}):window.location.reload():$("#modal-edit-student").find(".alert-danger").html('<i class="fa fa-times"></i> '+e.error).show()})}),$(".student-remove").unbind("click").on("click",function(){var e=$(this).data("id"),t=$(this).data("name"),a=$(this).data("load-id"),d=$(this).data("enrollment-id");$("#modal-remove-student").find(".alert-danger").hide(),$("#frm-remove-student").prop("action","students/"+e),$("#hdn-remove-student-load-id").val(a),$("#hdn-remove-student-enrollment-id").val(d),$("#lbl-remove-student-confirmation").html("Are you sure you want to remove '"+t+"' from this class?")}),$("#frm-remove-student").unbind("submit").on("submit",function(e){e.preventDefault();var t=$("#hdn-remove-student-id").val(),a=$("#hdn-remove-student-enrollment-id").val(),d=$("#hdn-remove-student-load-id").val(),o={id:d,student:{id:t,enrollment_id:a},path:window.location.pathname};$("#btn-remove-student").attr("disabled","disabled").find("i").removeClass("fa-check").addClass("fa-cog").addClass("fa-spin"),load.destroyStudent(o,function(e){$("#btn-remove-student").removeAttr("disabled").find("i").removeClass("fa-cog").removeClass("fa-spin").addClass("fa-check"),"OK"==e.status?e.tab_content?loads.reloadTabContent(e,"Student successfully removed!",function(){setTimeout(function(){$(".page-success").slideUp()},5e3),window.history.pushState("string","Serapina",e.path+"#load"+e.load.id)}):window.location.reload():($("#frm-remove-student").find(".alert-danger").show(),$("#frm-remove-student").find(".alert-danger span").text(e.error))})}),$(".invite-teacher").unbind("click").on("click",function(){$("#modal-invite-teacher").find("alert-danger").hide(),$("#ddl-invite-teacher-by").val("email"),$(".invite-by-account").show(),$("#modal-invite-teacher").find(".form-group").removeClass("has-success"),$("#modal-invite-teacher").find(".form-group").removeClass("has-error"),$("#txt-teacher-account").val(""),$("#hdn-teacher-account").val(""),$("#modal-invite-teacher").find(".form-group").removeClass("has-error"),$("#modal-add-students").find(".form-group").removeClass("has-success"),$invite_teacher_validator.resetForm(),$("#hdn-invite-teacher-load-id").val($(this).data("load-id"))}),$("#txt-teacher-account").autocomplete({serviceUrl:"/persons/ajaxShowTeachers",appendTo:$("#txt-teacher-account").parent().parent(),forceFixPosition:!0,onSelect:function(e){$("#txt-teacher-account").parent().find("input[type=hidden]").val(e.data),$("#txt-teacher-account").rules("remove","email"),$("#txt-teacher-account").valid(),$("#ddl-invite-teacher-by").val("account"),$("#txt-teacher-account").unbind("keyup").on("keyup",function(e){switch(e.keyCode){case 8:$("#hdn-teacher-account").val(""),$("#txt-teacher-account").rules("add",{email:!0}),$("#ddl-invite-teacher-by").val("email")}})},showNoSuggestionNotice:!1,onSearchComplete:function(){},formatResult:function(e,t){var a="("+t.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&")+")";console.log(e);var d;return d=e.image&&""!=e.image?e.image:"/plugins/smartadmin/img/avatars/"+e.gender+".png",'<div class="row"><div class="col-xs-2"><img class="thumbnail-sm" src="'+d+'" /></div><div class="col-xs-10"><div class="name"><b>'+e.value.replace(new RegExp(a,"gi"),"<strong>$1</strong>")+'</b></div><div class="desc"><span>'+(e.role?e.role.name:"")+(e.school?", "+e.school.name:"")+"</span></div></div></div>"}}),$invite_teacher_validator=$("#frm-invite-teacher").validate({rules:{account:{required:!0,email:!0}},messages:{account:"Please enter account or a valid email address."},highlight:function(e){$(e).closest(".form-group").removeClass("has-success").addClass("has-error")},unhighlight:function(e){$(e).closest(".form-group").removeClass("has-error").addClass("has-success")},errorElement:"span",errorClass:"help-block",errorPlacement:function(e,t){t.parent(".input-group").length?e.insertAfter(t.parent()):e.insertAfter(t)}}),$("#frm-invite-teacher").unbind("submit").on("submit",function(e){e.preventDefault();var t=$("#frm-invite-teacher").valid();if(!t)return $invite_teacher_validator.focusInvalid(),!1;var a,d,o=$("#ddl-invite-teacher-by").val();"account"==o?a=$("#hdn-teacher-account").val():"email"==o&&(d=$("#txt-teacher-account").val());var i=($("meta[name='csrf-token']").attr("content"),$("#hdn-invite-teacher-load-id").val()),n={id:i,account:a,email:d,invite_by:o};$("#btn-invite-teacher").attr("disabled","disabled").find("i").removeClass("fa-save").addClass("fa-cog").addClass("fa-spin"),load.inviteTeacher(n,function(e){$("#btn-invite-teacher").removeAttr("disabled").find("i").removeClass("fa-cog").removeClass("fa-spin").addClass("fa-save"),"OK"==e.status&&($("#modal-invite-teacher").modal("hide"),setTimeout(function(){$(".page-success").slideDown().find(".alert-success").html('<i class="fa fa-check"></i> Invites successfully sent!')},1e3),setTimeout(function(){$(".page-success").slideUp()},5e3),"/loads"!=window.location.pathname&&"/studentGrades"!=window.location.pathname&&"/studentLessons"!=window.location.pathname&&"/studentTests"!=window.location.pathname&&window.location.reload(!0))})}),$(".add-test-grades").unbind("click").on("click",function(){var e=$(this).data("activity-code"),t=$(this).data("activity-name"),a=$(this).data("activity-id");$("#txt-name").val(t),$("#txt-code").val(e),$("#hdn-id").val(a)}),$("#frm-add-test-grades").unbind("submit").on("submit",function(e){e.preventDefault();var t=$("#frm-add-test-grades").valid();if(!t)return $add_test_validator.focusInvalid(),!1;var a=$("#hdn-id").val(),d=$("#txt-name").val(),o={id:a,name:d};test.store(o,function(e){window.location.href="/tests/"+e.test.id+"/edit"})}),$(".drop-student").on("click",function(){var e=$(this).data("load-id"),t=$(this).data("id");$("#modal-drop-student").find(".alert-danger").hide(),$("#hdn-drop-student-load-id").val(e),$("#hdn-drop-student-student-id").val(t),$("#txt-drop-reason").val(""),$("#modal-drop-student .form-group").removeClass("has-error").removeClass("has-success")}),$("#frm-drop-student").on("submit",function(e){e.preventDefault();var t=$("#hdn-drop-student-load-id").val(),a=$("#hdn-drop-student-student-id").val(),d=$("#txt-drop-reason").val(),o={id:t,student_id:a,drop_reason:d,path:window.location.pathname};$("#btn-drop-student").attr("disabled","disabled").find("i").removeClass("fa-save").addClass("fa-cog").addClass("fa-spin"),load.dropStudent(o,function(e){$("#btn-drop-student").removeAttr("disabled").find("i").removeClass("fa-cog").removeClass("fa-spin").addClass("fa-save"),"OK"==e.status?e.tab_content?"/loads"==window.location.pathname&&loads.reloadTabContent(e,"Student successfully dropped!",function(){setTimeout(function(){$(".page-success").slideUp()},5e3)}):window.location.reload():$("#modal-drop-student").find(".alert-danger").html('<i class="fa fa-times"></i> '+e.error).show(),app.bindApp()})}),$(".undrop-student").unbind("click").on("click",function(e){e.preventDefault();var t=$("#hdn-undrop-student-load-id").val(),a=$("#hdn-undrop-student-student-id").val(),d=$("#hdn-undrop-student-enrollment-id").val(),o={id:t,student_id:a,enrollment_id:d,path:window.location.pathname};load.undropStudent(o,function(e){"OK"==e.status&&(e.tab_content?"/loads"==window.location.pathname&&loads.reloadTabContent(e,"Student successfully undropped!",function(){setTimeout(function(){$(".page-success").slideUp()},5e3)}):window.location.reload()),app.bindApp()})}),$(".load-leave").unbind("click").on("click",function(){var e=$(this).data("id"),t=$(this).data("name"),a=$(this).data("enrollment-id");$("#modal-leave-load").find(".alert-danger").hide(),$("#frm-leave-load").prop("action","loads/"+e),$("#hdn-leave-load-id").val(e),$("#hdn-leave-load-enrollment-id").val(a),$("#lbl-leave-load-confirmation").html("Are you sure you want to leave '"+t+"'?")}),$("#frm-leave-load").unbind("submit").on("submit",function(e){e.preventDefault();var t=$("#hdn-leave-load-id").val(),a=$("#hdn-leave-load-enrollment-id").val(),d={id:t,enrollment_id:a,path:window.location.pathname};$("#btn-leave-load").attr("disabled","disabled").find("i").removeClass("fa-check").addClass("fa-cog").addClass("fa-spin"),load.leave(d,function(e){$("#modal-leave-load").modal("hide"),$("body").removeClass("modal-open"),$(".modal-backdrop").remove(),"OK"==e.status?($("#frm-leave-load").find(".alert-danger").hide(),e.page_content&&e.ribbon_content?($("#btn-leave-load").removeAttr("disabled").find("i").removeClass("fa-cog").removeClass("fa-spin").addClass("fa-check"),"/loads"==e.path?loads.reloadPageContent(e,"Load successfully left!",function(){setTimeout(function(){$(".page-success").slideUp()},5e3)}):"/classes"==e.path&&classes.reloadPageContent(e,"Class successfully left!",function(){setTimeout(function(){$(".page-success").slideUp()},5e3)})):(window.location.href=e.path,window.location.reload())):($("#frm-leave-load").find(".alert-danger").show(),$("#frm-leave-load").find(".alert-danger span").text(e.error))})}),$(".pay-now-go").unbind("click").on("click",function(){r($(this)),$("#modal-pay-now .options-container").show(),$("#modal-pay-now").modal("show")}),$(".link-option.credit-card").unbind("click").on("click",function(){$(".options-container").hide(),$(".card-container").show()}),$(".payment-back").unbind("click").on("click",function(){$(".options-container").show(),$(".card-container").hide()});var h=$("#frm-pay-with-card").validate({rules:{"card-number":{required:!0},"card-expiry-month":{required:!0},"card-expiry-year":{required:!0},"card-cvc":{required:!0},"billing-street-address":{required:!0},"billing-city":{required:!0},"billing-province":{required:!0},"billing-zip":{required:!0}},messages:{"card-number":"Please enter the card number.","card-expiry-month":"Please enter the card expiration month.","card-expiry-year":"Please enter the card expiration year.","card-cvc":"Please enter the card CVC.","billing-street-address":"Please enter your billing street address.","billing-city":"Please enter your billing city.","billing-province":"Please enter your billing province.","billing-zip":"Please enter your billing zip code."},highlight:function(e){$(e).closest(".form-group").removeClass("has-success").addClass("has-error")},unhighlight:function(e){$(e).closest(".form-group").removeClass("has-error").addClass("has-success")},errorElement:"span",errorClass:"help-block",errorPlacement:function(e,t){t.parent(".input-group").length?e.insertAfter(t.parent()):e.insertAfter(t)}});$("#frm-pay-with-card").unbind("submit").on("submit",function(e){e.preventDefault();var t=$("#frm-pay-with-card").valid();if(!t)return h.focusInvalid(),!1;$("#modal-pay-now .card-container .alert-success").hide(),$("#modal-pay-now .card-container .alert-danger").hide();var a=(document.querySelector("#frm-pay-with-card"),$("#switch-privilege a").data("assignment-id")),d=$("#hdn-pay-with-card-role-plan-id").val(),o=document.querySelector("#modal-pay-now .card-number").value,i=document.querySelector("#modal-pay-now .card-cvc").value,n=document.querySelector("#modal-pay-now .card-expiry-month").value,l=document.querySelector("#modal-pay-now .card-expiry-year").value,s=document.querySelector("#modal-pay-now .billing-street-address").value,r=$("#modal-pay-now .billing-city"),c=$("#modal-pay-now .billing-province"),u=document.querySelector("#modal-pay-now .billing-zip").value,m={role_plan_id:d,assignment_id:a,customer:{street_address:s,city:{id:r.val(),name:r.find("option:selected").text()},province:{id:c.val(),name:c.find("option:selected").text()},zip:u},card:{number:o,cvc:i,exp_month:n,exp_year:l,status:"new"}};CSRF=$("meta[name='csrf-token']").attr("content"),$("#btn-send-payment").attr("disabled","disabled").find("i").removeClass("fa-money").addClass("fa-cog").addClass("fa-spin"),$.ajax({url:"/paymaya/pay",type:"POST",dataType:"json",data:m,success:function(e){$("#btn-send-payment").removeAttr("disabled").find("i").removeClass("fa-cog").removeClass("fa-spin").addClass("fa-money"),window.location.reload(!0)},error:function(e,t,a,d){$("#btn-send-payment").removeAttr("disabled").find("i").removeClass("fa-cog").removeClass("fa-spin").addClass("fa-money"),util.show500(),console.log(e.responseText)}})}),$(".switch-now-go").unbind("click").on("click",function(){r($(this)),$("#modal-pay-now .switch-plan-container").show(),$("#modal-pay-now").modal("show");var e=$(this).data("role-plan-id");$("#hdn-switch-plan-id").val(e)}),$(".cancel-now-go").unbind("click").on("click",function(){r($(this)),$("#modal-pay-now .cancel-plan-container").show(),$("#modal-pay-now").modal("show");var e=$(this).data("role-plan-id");$("#hdn-cancel-plan-id").val(e)}),$(".change-method-go").unbind("click").on("click",function(){r($(this)),$("#modal-pay-now .change-method-container").show(),$("#modal-pay-now").modal("show");var e=$(this).data("role-plan-id");$("#hdn-change-method-id").val(e)}),$(".switch-plan-continue").unbind("click").on("click",function(){var e=$("#switch-privilege a").data("assignment-id"),t=$("#hdn-switch-plan-id").val(),a={id:e,role_plan_id:t,mode:"recurring"};$(this).attr("disabled","disabled").html('<i class="fa fa-cog fa-spin"></i> '+$(this).html()),assignment.checkSwitchPlan(a,function(e){if($(".switch-plan-continue").removeAttr("disabled").html($(".switch-plan-continue").html().replace('<i class="fa fa-cog fa-spin"></i> ',"")),"OK"==e.status)if("PayPal"==e.provider){var t=$("#switch-privilege a").data("assignment-id");window.location.href="/paypal/ec-checkout-switch?mode=recurring&role_plan_id="+e.role_plan.id+"&assignment_id="+t}else window.location.reload(!0);else"NO_PAYER"==e.status?(r($(".switch-now-go[data-role-plan-id="+e.role_plan.id+"]")),$("#modal-pay-now .options-container").show(),$("#modal-pay-now").modal("show")):window.location.reload(!0)})}),$(".cancel-plan-continue").unbind("click").on("click",function(){var e=$("#switch-privilege a").data("assignment-id"),t={id:e};$(this).find("i").hide(),$(this).attr("disabled","disabled").html('<i class="fa fa-cog fa-spin"></i> '+$(this).html()),assignment.cancelPlan(t,function(e){$(".cancel-plan-continue").removeAttr("disabled").html($(".cancel-plan-continue").html().replace('<i class="fa fa-cog fa-spin"></i> ',"")),$(".cancel-plan-continue").find("i").show(),window.location.reload(!0)})}),$(".change-method-continue").unbind("click").on("click",function(){var e=$("#switch-privilege a").data("assignment-id"),t=$("#hdn-change-method-id").val(),a={id:e,role_plan_id:t};$(this).find("i").hide(),$(this).attr("disabled","disabled").html('<i class="fa fa-cog fa-spin"></i> '+$(this).html()),assignment.checkSwitchMethod(a,function(e){$(".change-method-continue").removeAttr("disabled").html($(".change-method-continue").html().replace('<i class="fa fa-cog fa-spin"></i> ',"")),$(".change-method-continue").find("i").show(),r($(".change-method-go[data-role-plan-id="+e.role_plan.id+"]")),$("#modal-pay-now .options-container").show()})}),$("select.select-single").select2().unbind("change").on("change",function(e){}),$("select.select-multiple").select2().unbind("change").on("change",function(e){}),$.fn.modal.Constructor.prototype.enforceFocus=function(){},$("#txt-message-details").length&&CKEDITOR.replace("txt-message-details",{height:"200px",startupFocus:!1,uiColor:"#FFFFFF",toolbar:[{name:"basicstyles",groups:["basicstyles","cleanup"],items:["Bold","Italic","Strike","-","RemoveFormat"]},{name:"insert",items:["Image","Table","HorizontalRule","SpecialChar"]},{name:"links",items:["Link","Unlink","Anchor"]},{name:"paragraph",groups:["list","indent","blocks","align","bidi"],items:["NumberedList","BulletedList","-","Outdent","Indent","-","Blockquote"]}]});var p=$("#frm-send-message").validate({ignore:[],rules:{ckeditor:{required:!0},first_name:{required:!0},middle_name:{required:!0},last_name:{required:!0},contact:{required:!0}},messages:{ckeditor:"Please provide more details.",first_name:"Please input your first name.",middle_name:"Please input your middle name.",last_name:"Please input your last name.",contact:"Please input your email."},highlight:function(e){$(e).closest(".form-group").removeClass("has-success").addClass("has-error")},unhighlight:function(e){$(e).closest(".form-group").removeClass("has-error").addClass("has-success")},errorElement:"span",errorClass:"help-block",errorPlacement:function(e,t){t.parent(".input-group").length?e.insertAfter(t.parent()):e.insertAfter(t)}});$("#frm-send-message").unbind("submit").on("submit",function(e){e.preventDefault();var a=CKEDITOR.instances["txt-message-details"].getData();$("#txt-message-details").val(a),a&&""!=a.trim()||p.showErrors({ckeditor:"Please provide more details."});var d=$("#frm-send-message").valid();if(!d)return p.focusInvalid(),!1;t=CKEDITOR.instances["txt-message-details"].document.getBody().getText(),t=t.split(".");var o=t[0],i=0,n=$("#txt-message-first-name").val(),l=$("#txt-message-middle-name").val(),s=$("#txt-message-last-name").val(),r=$("#txt-message-email").val(),c="email",u={title:o,responses:[{body:a}],owner:{first_name:n,middle_name:l,last_name:s,contact:{type:c,value:r}},_private:i,path:window.location.pathname};$("#btn-send-message").attr("disabled","disabled").find("i").addClass("fa-cog").addClass("fa-spin"),thread.store(u,function(e){"OK"==e.status?setTimeout(function(){$.smallBox({title:"Your message was sent successfully!",content:"<i class='fa fa-clock-o'></i> <i>We will get back to you using the contact information you have provided.</i>",color:"#468847",iconSmall:"fa fa-thumbs-up bounce animated",timeout:4e3}),$('#frm-send-message input[type="text"]').val(""),$('#frm-send-message input[type="email"]').val(""),CKEDITOR.instances["txt-message-details"].setData(""),$("#btn-send-message").removeAttr("disabled").find("i").removeClass("fa-cog").removeClass("fa-spin")},3e3):setTimeout(function(){$.smallBox({title:"Sending failed!",content:"<i class='fa fa-clock-o'></i> <i>2 seconds ago...</i>",color:"#C46A69",iconSmall:"fa fa-thumbs-down bounce animated",timeout:4e3}),$("#btn-send-message").removeAttr("disabled").find("i").removeClass("fa-cog").removeClass("fa-spin")},3e3)})}),pageSetUp()},App.prototype.bindNotifications=function(){$(".notification-action.mark-all-as-read").unbind("click").on("click",function(e){e.stopPropagation();var t=[];$(".notification-body .unread").each(function(){t.push($(this).parent().data("id"))});var a={ids:t};notification.markNotificationsAsRead(a,function(e){"OK"==e.status&&($(".notification-body .unread").removeClass("unread"),$(".notification-body .notification-actions .mark-as-read").removeClass("mark-as-read").addClass("mark-as-unread").find("i").removeClass("fa-circle").addClass("fa-circle-o"),$("#activity .badge").removeClass("bg-color-red").text("0"),app.bindNotifications())})}),$(".notification-actions .mark-as-read").unbind("click").on("click",function(e){e.stopPropagation();var t=$(this).parent().parent().parent().data("id"),a={ids:[t]};notification.markNotificationsAsRead(a,function(e){if("OK"==e.status){e.ids.forEach(function(e){$(".notification-body li[data-id="+e+"] > span").removeClass("unread"),$(".notification-body li[data-id="+e+"] .mark-as-read").removeClass("mark-as-read").addClass("mark-as-unread").find("i").removeClass("fa-circle").addClass("fa-circle-o")});var t=Number($("#activity .badge").text());t>0&&(t-=e.ids.length,$("#activity .badge").text(t)),0==t&&$("#activity .badge").removeClass("bg-color-red"),app.bindNotifications()}})}),$(".notification-actions .mark-as-unread").unbind("click").on("click",function(e){e.stopPropagation();var t=$(this).parent().parent().parent().data("id"),a={ids:[t]};notification.markNotificationsAsUnread(a,function(e){if("OK"==e.status){e.ids.forEach(function(e){$(".notification-body li[data-id="+e+"] > span").addClass("unread"),$(".notification-body li[data-id="+e+"] .mark-as-unread").removeClass("mark-as-unread").addClass("mark-as-read").find("i").removeClass("fa-circle-o").addClass("fa-circle")});var t=Number($("#activity .badge").text());t+=e.ids.length,$("#activity .badge").text(t).addClass("bg-color-red"),app.bindNotifications()}})})},App.prototype.showNotification=function(e){$.smallBox({title:e.title,content:e.body,color:"#4387bf",iconSmall:"fa "+e.icon+" bounce animated",timeout:5e3});var t=Number($("#activity .badge").text());$("#activity .badge").text(++t).addClass("bg-color-red")},App.prototype.bindNotices=function(){$(".notices .notice .close").unbind("click").on("click",function(){if($(this).closest(".notice").slideUp(500,function(){$(this).remove(),0==$(".notices .notice").length&&$(".notices").remove()}),$(this).hasClass("pay-now-dismiss")){var e=$("#switch-privilege a").data("assignment-id"),t={id:e};assignment.breakPromiseRolePlan(t,function(e){})}})},$(document).ready(function(){function e(){$this=$("#activity > .badge"),parseInt($this.text())>0&&$this.addClass("bg-color-red bounceIn animated")}function t(){window.location=$.loginURL}function a(){$.shortcut_dropdown.animate({height:"hide"},300,"easeOutCirc"),$.root_.removeClass("shortcut-on")}function d(){$.shortcut_dropdown.animate({height:"show"},200,"easeOutCirc"),$.root_.addClass("shortcut-on")}nav_page_height(),$("nav ul").jarvismenu({accordion:!0,speed:$.menu_speed,closedSign:'<em class="fa fa-expand-o"></em>',openedSign:'<em class="fa fa-collapse-o"></em>'}),$(".minifyme").click(function(e){$("body").toggleClass("minified"),$(this).effect("highlight",{},500),e.preventDefault()}),$("#hide-menu >:first-child > a").click(function(e){$("body").toggleClass("hidden-menu"),e.preventDefault()}),$("#show-shortcut").click(function(e){$.shortcut_dropdown.is(":visible")?a():d(),e.preventDefault()}),$("#search-mobile").click(function(){$.root_.addClass("search-mobile")}),$("#cancel-search-js").click(function(){$.root_.removeClass("search-mobile")}),$("#activity").click(function(e){var t=$(this);t.find(".badge").hasClass("bg-color-red")&&(t.find(".badge").removeClassPrefix("bg-color-"),t.find(".badge").text("0")),t.next(".ajax-dropdown").is(":visible")?(t.next(".ajax-dropdown").fadeOut(150),t.removeClass("active")):(t.next(".ajax-dropdown").fadeIn(150),t.addClass("active"));t.next(".ajax-dropdown").find(".btn-group > .active > input").attr("id");notification.showNotifications(function(e){"OK"==e.status&&e.notifications_content&&($(".ajax-notifications").empty().html(e.notifications_content),app.bindNotifications(),$("[rel=tooltip]").length&&$("[rel=tooltip]").tooltip())}),e.preventDefault()}),$('input[name="activity"]').change(function(){var e=$(this);url=e.attr("id"),container=$(".ajax-notifications"),loadURL(url,container)}),$(document).mouseup(function(e){$(".ajax-dropdown").is(e.target)||0!==$(".ajax-dropdown").has(e.target).length||($(".ajax-dropdown").fadeOut(150),$(".ajax-dropdown").prev().removeClass("active"))}),$("button[data-loading-text]").on("click",function(){var e=$(this);e.button("loading"),setTimeout(function(){e.button("reset")},3e3)}),e(),$("#refresh").click(function(e){$.SmartMessageBox({title:"<i class='fa fa-refresh' style='color:green'></i> Clear Local Storage",content:"Would you like to RESET all your saved widgets and clear LocalStorage?",buttons:"[No][Yes]"},function(e){"Yes"==e&&localStorage&&(localStorage.clear(),location.reload())}),e.preventDefault()}),$("#logout a").click(function(e){var a=$(this);$.loginURL=a.attr("href"),$.logoutMSG=a.data("logout-msg"),$.SmartMessageBox({title:"<i class='fa fa-sign-out txt-color-orangeDark'></i> Logout <span class='txt-color-orangeDark'><strong>"+$("#show-shortcut").text()+"</strong></span> ?",content:$.logoutMSG||"You can improve your security further after logging out by closing this opened browser",buttons:"[No][Yes]"},function(e){"Yes"==e&&($.root_.addClass("animated fadeOutUp"),setTimeout(t,1e3))}),e.preventDefault()}),$("#switch-privilege a").click(function(e){$(this).find("i").addClass("fa-spin");var t,a,d=$("meta[name='csrf-token']").attr("content"),o=$(this).data("username"),i=$(this).data("role"),n=$(this).data("school");$.ajax({url:"/auth/ajaxShowUserRoles",type:"POST",dataType:"json",data:{_token:d,username:o},success:function(e){if("OK"==e.status)if(1==e.result.length)if(t=e.result[0].id,0==e.result.length)$.ajax({url:"/auth/ajaxSetUserRoleSchool",type:"POST",dataType:"json",data:{_token:d,role:t,school:null},success:function(e){"OK"==e.status&&(window.location.href=e.redirect)},error:function(e,t,a,d){console.log(e.responseText)}});else if(1==e.schools.length)a=schools[0].id,$.ajax({url:"/auth/ajaxSetUserRoleSchool",type:"POST",dataType:"json",data:{_token:d,role:t,school:a},success:function(e){"OK"==e.status&&(window.location.href=e.redirect)},error:function(e,t,a,d){console.log(e.responseText)}});else{var o="";e.schools.forEach(function(e){o+=e.id+"["+e.name+"]"}),$.SmartMessageBox({title:"Select Your School",content:"You can change your school anytime.",buttons:"[Cancel][Submit]",input:"select",options:o},function(o,i){"Submit"==o?e.schools.forEach(function(e){e.name==i&&(a=e.id,$.ajax({url:"/auth/ajaxSetUserRoleSchool",type:"POST",dataType:"json",data:{_token:d,role:t,school:a},success:function(e){"OK"==e.status&&(window.location.href=e.redirect)},error:function(e,t,a,d){console.log(e.responseText)}}))}):$("#switch-privilege a").find("i").removeClass("fa-spin")}),$("#txt1 option:contains("+n+")").each(function(){return $(this).text()==n?($(this).attr("selected","selected"),!1):!0})}else if(e.result.length>1){var o="";e.result.forEach(function(e){o+=e.id+"["+e.name+"]"}),$.SmartMessageBox({title:"Select Your Role",content:"You can change your role anytime.",buttons:"[Cancel][Submit]",input:"select",options:o},function(o,i){"Submit"==o?e.result.forEach(function(o){o.name==i&&(t=o.id,$.ajax({url:"/auth/ajaxShowUserRoleSchools",type:"POST",dataType:"json",data:{_token:d,username:e.username,role:o.id},success:function(e){if("OK"==e.status)if(0==e.result.length)$.ajax({url:"/auth/ajaxSetUserRoleSchool",type:"POST",dataType:"json",data:{_token:d,role:t,school:null},success:function(e){"OK"==e.status&&(window.location.href=e.redirect)},error:function(e,t,a,d){console.log(e.responseText)}});else if(1==e.result.length)a=e.result[0].id,$.ajax({url:"/auth/ajaxSetUserRoleSchool",type:"POST",dataType:"json",data:{_token:d,role:t,school:a},success:function(e){"OK"==e.status&&(window.location.href=e.redirect)},error:function(e,t,a,d){console.log(e.responseText)}});else{var o="";e.result.forEach(function(e){o+=e.id+"["+e.name+"]"}),$.SmartMessageBox({title:"Select Your School",content:"You can change your school anytime.",buttons:"[Cancel][Submit]",input:"select",options:o},function(o,i){"Submit"==o?e.result.forEach(function(o){o.name==i&&(a=e.result[0].id,$.ajax({url:"/auth/ajaxSetUserRoleSchool",type:"POST",dataType:"json",data:{_token:d,role:t,school:a},success:function(e){return"OK"==e.status?(window.location.href=e.redirect,!1):void 0},error:function(e,t,a,d){console.log(e.responseText)}}))}):$("#switch-privilege a").find("i").removeClass("fa-spin")}),$("#txt1 option:contains("+n+")").each(function(){return $(this).text()==n?($(this).attr("selected","selected"),!1):!0})}},error:function(e,t,a,d){console.log(e.responseText)}}))}):$("#switch-privilege a").find("i").removeClass("fa-spin")}),$("#txt1 option:contains("+i+")").each(function(){return $(this).text()==i?($(this).attr("selected","selected"),!1):!0})}},error:function(e,t,a,d){console.log(e.responseText)}})}),$.shortcut_dropdown.find("a").click(function(e){e.preventDefault(),window.location=$(this).attr("href"),setTimeout(a,300)}),$(document).mouseup(function(e){$.shortcut_dropdown.is(e.target)||0!==$.shortcut_dropdown.has(e.target).length||a()}),tab.init(),$(".supervision-autocomplete").autocomplete({serviceUrl:"/schools/ajaxShowPossibleSupervisions",appendTo:$(".supervision-id").parent().parent(),forceFixPosition:!0,
onSelect:function(e){$(this).parent().find("input[type=hidden]").val(e.data)},showNoSuggestionNotice:!0}),$(".supervision-autocomplete").on("change",function(){""==$(this).val()&&$(this).parent().find("input[type=hidden]").val("")}),$(".supervision-autocomplete").on("blur",function(){""==$(this).parent().find("input[type=hidden]").val()&&$(this).val("")}),$("#txt-add-school-city").geocomplete({country:"PH"}).bind("geocode:result",function(e,t){$("#hdn-add-school-location-address").val(t.formatted_address),$("#hdn-add-school-location-lng").val(t.geometry.location.lng()),$("#hdn-add-school-location-lat").val(t.geometry.location.lat())}),$add_school_validator=$("#frm-add-school").validate({rules:{name:{required:!0},region:{required:!0},province:{required:!0},municipality:{required:!0},division:{required:!0},district:{required:!0}},messages:{name:"Please enter the school name.",region:"Please enter the region.",province:"Please enter the province.",municipality:"Please enter the municipality.",division:"Please enter the division.",district:"Please enter the district."},highlight:function(e){$(e).closest(".form-group").removeClass("has-success").addClass("has-error")},unhighlight:function(e){$(e).closest(".form-group").removeClass("has-error").removeClass("has-success").addClass("has-success")},errorElement:"span",errorClass:"help-block",errorPlacement:function(e,t){t.parent(".input-group").length?e.insertAfter(t.parent()):e.insertAfter(t)}}),$("#frm-add-school").on("submit",function(e){e.preventDefault();var t=$("#frm-add-school").valid();if(!t)return $add_school_validator.focusInvalid(),!1;var a=$("#txt-add-school-id").val(),d=$("#txt-add-school-name").val(),o=$("#txt-add-school-abbreviation").val(),i=$("#txt-add-school-street-address").val(),n=$("#hdn-add-school-location-address").val(),l=$("#hdn-add-school-location-lat").val(),s=$("#hdn-add-school-location-lng").val(),r=$("#txt-add-school-zip").val(),c=$("#txt-add-school-phone").val(),u=$("#txt-add-school-mobile").val(),m=$("#txt-add-school-fax").val(),h=$("#hdn-add-school-supervision-id").val(),p=$("#msl-add-school-curricular-classifications").val(),f={reference_no:a,name:d,abbreviation:o,street_address:i,location_address:n,location_lat:l,location_lng:s,zip:r,phone:c,mobile:u,fax:m,district_id:h,curricular_classifications:p};school.store(f,function(e){"OK"==e.status?($("#frm-add-school").find(".alert-danger").hide(),add_school_success_callback&&add_school_success_callback(e)):($("#frm-add-school").find(".alert-danger").show(),$("#frm-add-school").find(".alert-danger span").text(e.error))})}),app.bindApp()}),function(e,t,a){function d(){o=t[l](function(){i.each(function(){var t=e(this),a=t.width(),d=t.height(),o=e.data(this,r);(a!==o.w||d!==o.h)&&t.trigger(s,[o.w=a,o.h=d])}),d()},n[c])}var o,i=e([]),n=e.resize=e.extend(e.resize,{}),l="setTimeout",s="resize",r=s+"-special-event",c="delay",u="throttleWindow";n[c]=e.throttle_delay,n[u]=!0,e.event.special[s]={setup:function(){if(!n[u]&&this[l])return!1;var t=e(this);i=i.add(t),e.data(this,r,{w:t.width(),h:t.height()}),1===i.length&&d()},teardown:function(){if(!n[u]&&this[l])return!1;var t=e(this);i=i.not(t),t.removeData(r),i.length||clearTimeout(o)},add:function(t){function d(t,d,i){var n=e(this),l=e.data(this,r);l.w=d!==a?d:n.width(),l.h=i!==a?i:n.height(),o.apply(this,arguments)}if(!n[u]&&this[l])return!1;var o;return e.isFunction(t)?(o=t,d):(o=t.handler,void(t.handler=d))}}}(jQuery,this),$("#main").resize(function(){nav_page_height(),check_if_mobile_width()}),$("nav").resize(function(){nav_page_height()});var ie=function(){for(var e,t=3,a=document.createElement("div"),d=a.getElementsByTagName("i");a.innerHTML="<!--[if gt IE "+ ++t+"]><i></i><![endif]-->",d[0];);return t>4?t:e}();$.fn.extend({jarvismenu:function(e){var t={accordion:"true",speed:200,closedSign:"[+]",openedSign:"[-]"},a=$.extend(t,e),d=$(this);d.find("li").each(function(){0!=$(this).find("ul").size()&&($(this).find("a:first").append("<b class='collapse-sign'>"+a.closedSign+"</b>"),"#"==$(this).find("a:first").attr("href")&&$(this).find("a:first").click(function(){return!1}))}),d.find("li.active").each(function(){$(this).parents("ul").slideDown(a.speed),$(this).parents("ul").parent("li").find("b:first").html(a.openedSign),$(this).parents("ul").parent("li").addClass("open")}),d.find("li a").click(function(){0!=$(this).parent().find("ul").size()&&(a.accordion&&($(this).parent().find("ul").is(":visible")||(parents=$(this).parent().parents("ul"),visible=d.find("ul:visible"),visible.each(function(e){var t=!0;parents.each(function(a){return parents[a]==visible[e]?(t=!1,!1):void 0}),t&&$(this).parent().find("ul")!=visible[e]&&$(visible[e]).slideUp(a.speed,function(){$(this).parent("li").find("b:first").html(a.closedSign),$(this).parent("li").removeClass("open")})}))),$(this).parent().find("ul:first").is(":visible")&&!$(this).parent().find("ul:first").hasClass("active")?$(this).parent().find("ul:first").slideUp(a.speed,function(){$(this).parent("li").removeClass("open"),$(this).parent("li").find("b:first").delay(a.speed).html(a.closedSign)}):$(this).parent().find("ul:first").slideDown(a.speed,function(){$(this).parent("li").addClass("open"),$(this).parent("li").find("b:first").delay(a.speed).html(a.openedSign)}))})}}),jQuery.fn.doesExist=function(){return jQuery(this).length>0};var gMapsLoaded=!1;window.gMapsCallback=function(){gMapsLoaded=!0,$(window).trigger("gMapsLoaded")},window.loadGoogleMaps=function(){if(gMapsLoaded)return window.gMapsCallback();var e=document.createElement("script");e.setAttribute("type","text/javascript"),e.setAttribute("src","http://maps.google.com/maps/api/js?sensor=false&callback=gMapsCallback"),(document.getElementsByTagName("head")[0]||document.documentElement).appendChild(e)};var jsArray={};$.navAsAjax&&($(".page-preloader").height($(window).height()),$(document).on("click",'#left-panel nav a[href!="#"]',function(e){e.preventDefault();var t=$(e.currentTarget);if(!t.parent().hasClass("active")&&!t.attr("target")){var a=t.attr("href");$("#left-panel nav li.active").removeClass("active"),$('#left-panel nav li:has(a[href="'+a+'"])').addClass("active"),$.root_.hasClass("mobile-view-activated")?($.root_.removeClass("hidden-menu"),window.setTimeout(function(){util.partialRedirect(a)},150)):util.partialRedirect(a)}}),$(document).on("click",'a[data-partial="true"]',function(e){e.preventDefault();var t=$(e.currentTarget),a=t.attr("href");if(""!=a&&"#"!=a){var d=window.location.href;window.history.pushState("string","Serapina",a);var o=window.location.pathname;window.history.pushState("string","Serapina",d),util.partialRedirect(a);var i=$('#left-panel nav a[href="'+o+'"]');i.parent().hasClass("active")||i.attr("target")||($("#left-panel nav li.active").removeClass("active"),$("#left-panel nav li.open").removeClass("open").find("> ul").hide(),i.parent().addClass("active"),i.parent().parent()&&i.parent().parent().parent()&&i.parent().parent().parent().addClass("active").addClass("open").find("> ul").show())}}),$(document).on("click",'#left-panel nav a[target="_blank"]',function(e){e.preventDefault();var t=$(e.currentTarget);window.open(t.attr("href"))}),$(document).on("click",'#left-panel nav a[target="_top"]',function(e){e.preventDefault();var t=$(e.currentTarget);window.location=t.attr("href")}),$(document).on("click",'#left-panel nav a[href="#"]',function(e){e.preventDefault()})),$("body").on("click",function(e){$('[rel="popover"]').each(function(){$(this).is(e.target)||0!==$(this).has(e.target).length||0!==$(".popover").has(e.target).length||$(this).popover("hide")})});